(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2791:(e,t,r)=>{Promise.resolve().then(r.bind(r,2212))},2212:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>j});var a=r(7437),s=r(2265),l=r(7719),o=r.n(l);o().accessToken="pk.eyJ1IjoiZG9jamJhaWxleTE5NzEiLCJhIjoiY21ld3lzZTNqMGQwdzJxb2lwNHpjcjNveiJ9.T2O5szdwL-O5nDF9BJmFnw";let i={Agronomy:{color:"#FFD700",outline:"#000"},"Grain/Feed":{color:"#228B22",outline:"#000"},"Office/Service":{color:"#1E90FF",outline:"#000"},Kingpin:{color:"#FF0000",outline:"#FFFF00"}},n=e=>{switch((e||"").trim().toLowerCase()){case"agronomy":return"agronomy";case"grain/feed":case"grainfeed":return"grainfeed";case"office/service":case"officeservice":return"officeservice";case"kingpin":return"kingpin";default:return(e||"").trim().toLowerCase()}},c=e=>(e||"").toString().trim().toLowerCase(),d={chs:"CHS",winfield:"Winfield",helena:"Helena",rosens:"Rosens",growmark:"Growmark",iap:"IAP","wilbur-ellis":"Wilbur-Ellis"};function p(e){let t=(e||"").trim().toLowerCase();return d[t]?d[t]:e.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function u(e){return e?e.split(",").map(e=>e.trim()).filter(e=>e.length>0).map(p):[]}function x(e){let{selectedCategories:t,selectedStates:r,selectedSuppliers:l,selectedRetailers:d,onStatesLoaded:p,onRetailersLoaded:x,onSuppliersLoaded:m,onRetailerSummary:g,onAddStop:h,tripStops:y=[],tripMode:f="entered"}=e,b=(0,s.useRef)(null),j=(0,s.useRef)(null),N="".concat("/certis_agroute_app","/data/retailers.geojson?cacheBust=").concat(Date.now());return(0,s.useEffect)(()=>{if(j.current)return;let e=new(o()).Map({container:b.current,style:"mapbox://styles/mapbox/satellite-streets-v12",center:[-98.5795,39.8283],zoom:4,projection:"mercator"});j.current=e,e.on("load",async()=>{try{let n=await fetch(N),c=await n.json(),d=new Set,g=new Set,y=new Set;for(let e of c.features){var t,r,a;let s=null===(t=e.properties)||void 0===t?void 0:t.State,l=null===(r=e.properties)||void 0===r?void 0:r["Long Name"],o=null===(a=e.properties)||void 0===a?void 0:a.Suppliers;s&&d.add(s),l&&g.add(l),u(o).forEach(e=>y.add(e))}null==p||p(Array.from(d).sort()),null==m||m(Array.from(y).sort()),null==x||x(Array.from(g).sort()),e.addSource("retailers",{type:"geojson",data:c}),e.addLayer({id:"retailers-layer",type:"circle",source:"retailers",paint:{"circle-radius":4,"circle-color":["match",["get","Category"],"Agronomy",i.Agronomy.color,"Grain/Feed",i["Grain/Feed"].color,"Office/Service",i["Office/Service"].color,"#1d4ed8"],"circle-stroke-width":2,"circle-stroke-color":"#fff"},filter:["!=",["get","Category"],"Kingpin"]}),e.addLayer({id:"kingpins-layer",type:"circle",source:"retailers",paint:{"circle-radius":7,"circle-color":i.Kingpin.color,"circle-stroke-width":2,"circle-stroke-color":i.Kingpin.outline},filter:["==",["get","Category"],"Kingpin"]});let f=new(o()).Popup({closeButton:!1,closeOnClick:!1,maxWidth:"none"});function s(e,t){let r=e["Long Name"]||e.Retailer||"Unknown",a=e.Name||"",s=e.Category||"N/A",l=a?"".concat(r," â€“ ").concat(a):r,o=u(e.Suppliers).join(", ")||"N/A",i="add-stop-".concat(Math.random().toString(36).slice(2)),n="".concat(e.Address||"",", ").concat(e.City||"",", ").concat(e.State||""," ").concat(e.Zip||""),c='\n            <div style="font-size: 13px; width:360px; background:#1a1a1a; color:#f5f5f5;\n                        padding:6px; border-radius:4px; position:relative;">\n              <button id="'.concat(i,'"\n                style="position:absolute; top:4px; right:4px; padding:2px 6px;\n                       background:#166534; color:#fff; border:none; border-radius:3px;\n                       font-size:11px; cursor:pointer; display:flex; align-items:center; gap:4px; font-weight:600;">\n                <span style="background:#fff; color:#166534; border-radius:50%; width:14px; height:14px;\n                             display:flex; align-items:center; justify-content:center; font-size:11px; font-weight:bold;">\n                  +\n                </span>\n                Add to Trip\n              </button>\n              <strong>').concat(r,"</strong><br/>\n              <em>").concat(a,"</em><br/>\n              ").concat(e.Address||"","<br/>\n              ").concat(e.City||""," ").concat(e.State||""," ").concat(e.Zip||"","<br/>\n              <strong>Category:</strong> ").concat(s,"<br/>\n              Suppliers: ").concat(o,"\n            </div>\n          ");return setTimeout(()=>{let e=document.getElementById(i);e&&h&&(e.onclick=()=>h({label:l,address:n,coords:t}))},0),c}function l(t){e.on("mouseenter",t,t=>{var r,a,l;e.getCanvas().style.cursor="pointer";let o=null===(a=t.features)||void 0===a?void 0:null===(r=a[0].geometry)||void 0===r?void 0:r.coordinates.slice(),i=null===(l=t.features)||void 0===l?void 0:l[0].properties;o&&i&&f.setLngLat(o).setHTML(s(i,o)).addTo(e)}),e.on("mouseleave",t,()=>{e.getCanvas().style.cursor="",f.remove()}),e.on("click",t,t=>{var r,a,l;let i=null===(a=t.features)||void 0===a?void 0:null===(r=a[0].geometry)||void 0===r?void 0:r.coordinates.slice(),n=null===(l=t.features)||void 0===l?void 0:l[0].properties;i&&n&&new(o()).Popup({maxWidth:"none"}).setLngLat(i).setHTML(s(n,i)).addTo(e)})}l("retailers-layer"),l("kingpins-layer")}catch(e){console.error("Failed to load GeoJSON",e)}})},[N,p,x,m,h]),(0,s.useEffect)(()=>{if(!j.current)return;let e=j.current.getSource("retailers");e&&fetch(N).then(e=>e.json()).then(a=>{let s={type:"FeatureCollection",features:a.features.filter(e=>{let a=e.properties||{};if("Kingpin"===a.Category)return!0;let s=0===r.length||r.map(c).includes(c(a.State)),o=0===d.length||d.map(c).includes(c(a["Long Name"])),i=0===t.length||t.map(n).includes(n(a.Category)),p=u(a.Suppliers).map(c),x=0===l.length||l.map(c).some(e=>p.includes(e));return s&&o&&i&&x})};if(e.setData(s),g){let e=new Map;for(let t of s.features){let r=t.properties||{};if("Kingpin"===r.Category)continue;let a=r.State||"Unknown",s=r["Long Name"]||r.Retailer||"Unknown",l=u(r.Suppliers),o="".concat(a,"-").concat(s);e.has(o)||e.set(o,{state:a,retailer:s,count:0,suppliers:[]});let i=e.get(o);i.count+=1,l.forEach(e=>{e&&!i.suppliers.includes(e)&&i.suppliers.push(e)})}g(Array.from(e.values()))}if(x){let e=new Set;for(let t of a.features){let a=t.properties||{};"Kingpin"!==a.Category&&(0===r.length||r.map(c).includes(c(a.State)))&&a["Long Name"]&&e.add(a["Long Name"])}x(Array.from(e).sort())}})},[N,r,d,t,l,g,x]),(0,s.useEffect)(()=>{if(!j.current)return;let e=j.current;if(y.length<2){e.getLayer("trip-route")&&(e.removeLayer("trip-route"),e.removeSource("trip-route")),e.getLayer("trip-stops")&&(e.removeLayer("trip-stops"),e.removeSource("trip-stops"));return}let t=y.map(e=>e.coords.join(",")).join(";");fetch("https://api.mapbox.com/directions/v5/mapbox/driving/".concat(t,"?geometries=geojson").concat("optimize"===f?"&optimize=true":"","&access_token=").concat(o().accessToken)).then(e=>e.json()).then(t=>{if(!t.routes||0===t.routes.length)return;let r=t.routes[0].geometry;e.getLayer("trip-route")&&(e.removeLayer("trip-route"),e.removeSource("trip-route")),e.addSource("trip-route",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:r,properties:{}}]}}),e.addLayer({id:"trip-route",type:"line",source:"trip-route",paint:{"line-color":"#1E90FF","line-width":4}});let a={type:"FeatureCollection",features:y.map((e,t)=>({type:"Feature",geometry:{type:"Point",coordinates:e.coords},properties:{order:t+1,label:e.label}}))};e.getLayer("trip-stops")&&(e.removeLayer("trip-stops"),e.removeSource("trip-stops")),e.addSource("trip-stops",{type:"geojson",data:a}),e.addLayer({id:"trip-stops",type:"symbol",source:"trip-stops",layout:{"text-field":["get","order"],"text-size":14,"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-offset":[0,.6],"text-anchor":"top"},paint:{"text-color":"#1E90FF","text-halo-color":"#ffffff","text-halo-width":2}})}).catch(e=>console.error("Directions API error:",e))},[y,f]),(0,a.jsx)("div",{ref:b,className:"w-full h-full"})}var m=r(6648),g=r(4697),h=r(2873);let y="pk.eyJ1IjoiZG9jamJhaWxleTE5NzEiLCJhIjoiY21ld3lzZTNqMGQwdzJxb2lwNHpjcjNveiJ9.T2O5szdwL-O5nDF9BJmFnw",f=e=>(e||"").toString().trim().toLowerCase(),b=e=>(e||"").toUpperCase();function j(){let[e,t]=(0,s.useState)([]),[r,l]=(0,s.useState)([]),[o,n]=(0,s.useState)([]),[c,d]=(0,s.useState)([]),[p,u]=(0,s.useState)([]),[j,N]=(0,s.useState)([]),[v,k]=(0,s.useState)([]),[w,S]=(0,s.useState)([]),[C,L]=(0,s.useState)(!1),[F,A]=(0,s.useState)([]),[z,E]=(0,s.useState)("entered"),[O,T]=(0,s.useState)(""),[J,R]=(0,s.useState)(null),_=async()=>{if(O&&y)try{let e=await fetch("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(encodeURIComponent(O),".json?access_token=").concat(y,"&limit=1")),t=await e.json();if(t.features&&t.features.length>0){let[e,r]=t.features[0].center;R([e,r]);let a={label:"Home (".concat(O,")"),address:O,coords:[e,r]};A(e=>{let t=e.filter(e=>!e.label.startsWith("Home"));return[a,...t]})}}catch(e){console.error("Error geocoding ZIP:",e)}},K=e=>{let t=f(e);d(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},M=e=>{let t=f(e);u(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},Z=e=>{N(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},H=e=>{let t=f(e);k(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])};w.filter(e=>"kingpin"===f(e.retailer)||"kingpin"===f(e.category||""));let I=w.filter(e=>"kingpin"!==f(e.retailer)&&"kingpin"!==f(e.category||"")),G=(0,s.useMemo)(()=>0===p.length?r:w.filter(e=>p.includes(f(e.state))).map(e=>e.retailer).filter((e,t,r)=>r.indexOf(e)===t).sort(),[r,w,p]);return(0,a.jsxs)("div",{className:"flex h-screen w-screen relative",children:[(0,a.jsx)("button",{className:"absolute top-3 left-3 z-20 p-2 bg-gray-800 text-white rounded-md md:hidden",onClick:()=>L(!C),"aria-label":"Toggle sidebar",children:C?(0,a.jsx)(g.Z,{size:20}):(0,a.jsx)(h.Z,{size:20})}),(0,a.jsxs)("aside",{className:"fixed md:static top-0 left-0 h-full w-96 bg-gray-100 dark:bg-gray-900 p-4 border-r border-gray-300 dark:border-gray-700 overflow-y-auto z-10 transform transition-transform duration-300\n        ".concat(C?"translate-x-0":"-translate-x-full"," md:translate-x-0"),children:[(0,a.jsx)("div",{className:"flex items-center justify-center mb-6",children:(0,a.jsx)(m.default,{src:"".concat("/certis_agroute_app","/certis-logo.png"),alt:"Certis Logo",width:180,height:60,priority:!0})}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Home Zip Code"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("input",{type:"text",value:O,onChange:e=>T(e.target.value),placeholder:"Enter ZIP",className:"flex-1 p-2 rounded border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100"}),(0,a.jsx)("button",{onClick:_,className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Set"})]}),J&&(0,a.jsxs)("p",{className:"mt-2 text-sm text-green-600 dark:text-green-400",children:["Home set at ",O," âœ”"]})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"State Filter"}),(0,a.jsxs)("div",{className:"flex space-x-2 mb-3",children:[(0,a.jsx)("button",{onClick:()=>u(e.map(f)),className:"px-2 py-1 bg-blue-600 text-white rounded text-sm",children:"Select All"}),(0,a.jsx)("button",{onClick:()=>u([]),className:"px-2 py-1 bg-gray-600 text-white rounded text-sm",children:"Clear All"})]}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2",children:e.map(e=>(0,a.jsxs)("label",{className:"flex items-center space-x-1",children:[(0,a.jsx)("input",{type:"checkbox",checked:p.includes(f(e)),onChange:()=>M(e),className:"mr-1"}),(0,a.jsx)("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:b(e)})]},e))})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Retailer Filter"}),(0,a.jsxs)("div",{className:"flex space-x-2 mb-3",children:[(0,a.jsx)("button",{onClick:()=>k(r.map(f)),className:"px-2 py-1 bg-blue-600 text-white rounded text-sm",children:"Select All"}),(0,a.jsx)("button",{onClick:()=>k([]),className:"px-2 py-1 bg-gray-600 text-white rounded text-sm",children:"Clear All"})]}),(0,a.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:r.map(e=>(0,a.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:v.includes(f(e)),onChange:()=>H(e)}),(0,a.jsx)("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:e})]},e))})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Supplier Filter"}),(0,a.jsxs)("div",{className:"flex space-x-2 mb-3",children:[(0,a.jsx)("button",{onClick:()=>N(o),className:"px-2 py-1 bg-blue-600 text-white rounded text-sm",children:"Select All"}),(0,a.jsx)("button",{onClick:()=>N([]),className:"px-2 py-1 bg-gray-600 text-white rounded text-sm",children:"Clear All"})]}),(0,a.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:o.map(e=>(0,a.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:j.includes(e),onChange:()=>Z(e)}),(0,a.jsx)("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:e})]},e))})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Categories"}),(0,a.jsxs)("div",{className:"flex space-x-2 mb-4",children:[(0,a.jsx)("button",{onClick:()=>{d(Object.keys(i).filter(e=>"Kingpin"!==e).map(f))},className:"px-2 py-1 bg-blue-600 text-white rounded text-sm",children:"Select All"}),(0,a.jsx)("button",{onClick:()=>d([]),className:"px-2 py-1 bg-gray-600 text-white rounded text-sm",children:"Clear All"})]}),(0,a.jsx)("ul",{className:"space-y-2",children:Object.entries(i).map(e=>{let[t,r]=e;return(0,a.jsx)("li",{className:"flex items-center",children:"Kingpin"!==t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"checkbox",id:"filter-".concat(t),checked:c.includes(f(t)),onChange:()=>K(t),className:"mr-2"}),(0,a.jsxs)("label",{htmlFor:"filter-".concat(t),className:"flex items-center text-gray-700 dark:text-gray-300",children:[(0,a.jsx)("span",{className:"inline-block w-4 h-4 mr-2 rounded-full border",style:{backgroundColor:r.color,borderColor:r.outline||"#000"}}),t]})]}):(0,a.jsxs)("div",{className:"flex items-center text-gray-700 dark:text-gray-300 ml-1",children:[(0,a.jsx)("span",{className:"inline-block w-4 h-4 mr-2 rounded-full border",style:{backgroundColor:r.color,borderColor:r.outline||"#000"}}),t]})},t)})}),(0,a.jsx)("p",{className:"mt-3 text-sm text-red-600 dark:text-yellow-400 font-semibold",children:"Kingpins are always visible (bright red, yellow border)."})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Channel Summary"}),(0,a.jsxs)("div",{className:"text-sm text-gray-700 dark:text-gray-300 space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("strong",{children:["States Selected (",p.length,"):"]})," ",p.length>0?p.map(b).join(", "):"None"]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("strong",{children:["Retailers Selected (",v.length,"):"]}),v.length>0?(0,a.jsx)("ul",{className:"list-disc ml-5",children:G.filter(e=>v.includes(f(e))).map((e,t)=>(0,a.jsx)("li",{children:e},t))}):" None"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Site Summaries:"}),I.length>0?(0,a.jsx)("ul",{className:"list-disc ml-5",children:I.map((e,t)=>(0,a.jsxs)("li",{children:[e.retailer," â€“ ",e.count," sites"]},t))}):" None"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Supplier Summaries:"}),I.length>0?(0,a.jsx)("ul",{className:"list-disc ml-5",children:I.map((e,t)=>(0,a.jsxs)("li",{children:[e.retailer," â€“ ",e.suppliers&&e.suppliers.length>0?e.suppliers.join(", "):"N/A"]},t))}):" None"]})]})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Trip Optimization"}),(0,a.jsxs)("div",{className:"flex space-x-4 mb-3 text-sm",children:[(0,a.jsxs)("label",{className:"flex items-center space-x-1 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",value:"entered",checked:"entered"===z,onChange:()=>E("entered")}),(0,a.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:"Map as Entered"})]}),(0,a.jsxs)("label",{className:"flex items-center space-x-1 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",value:"optimize",checked:"optimize"===z,onChange:()=>E("optimize")}),(0,a.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:"Optimize Route"})]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"Selected stops will appear below:"}),F.length>0?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("ol",{className:"list-decimal ml-5 text-sm text-gray-700 dark:text-gray-300",children:F.map((e,t)=>(0,a.jsxs)("li",{children:[(0,a.jsx)("div",{className:"font-semibold",children:e.label}),(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.address})]},t))}),(0,a.jsx)("button",{onClick:()=>A([]),className:"mt-2 px-2 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700",children:"Clear All"})]}):(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No stops added yet."})]})]}),(0,a.jsx)("main",{className:"flex-1 relative",children:(0,a.jsx)(x,{selectedCategories:c,selectedStates:p,selectedSuppliers:j,selectedRetailers:v,onStatesLoaded:t,onRetailersLoaded:l,onSuppliersLoaded:n,onRetailerSummary:S,onAddStop:e=>{F.some(t=>t.label===e.label&&t.address===e.address)||A(t=>[...t,e])},tripStops:F,tripMode:z})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[415,758,130,215,744],()=>t(2791)),_N_E=e.O()}]);