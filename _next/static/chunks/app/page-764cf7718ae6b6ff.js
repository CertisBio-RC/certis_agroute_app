(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2791:(e,t,r)=>{Promise.resolve().then(r.bind(r,2212))},2212:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var s=r(7437),l=r(2265),a=r(7719),i=r.n(a),n=r(357);i().accessToken="pk.eyJ1IjoiZG9jamJhaWxleTE5NzEiLCJhIjoiY21ld3lzZTNqMGQwdzJxb2lwNHpjcjNveiJ9.T2O5szdwL-O5nDF9BJmFnw";let o={Agronomy:{color:"#FFD700",outline:"#000"},"Grain/Feed":{color:"#228B22",outline:"#000"},"Office/Service":{color:"#1E90FF",outline:"#000"},Kingpin:{color:"#FF0000",outline:"#FFFF00"}},c=e=>{switch((e||"").trim().toLowerCase()){case"agronomy":return"agronomy";case"grain/feed":case"grainfeed":return"grainfeed";case"office/service":case"officeservice":return"officeservice";case"kingpin":return"kingpin";default:return(e||"").trim().toLowerCase()}},d=e=>(e||"").toString().trim().toLowerCase(),p={chs:"CHS",winfield:"Winfield",helena:"Helena",rosens:"Rosens",growmark:"Growmark",iap:"IAP"};function g(e){let t=(e||"").trim().toLowerCase();return p[t]?p[t]:e.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function x(e){return e?e.split(",").map(e=>e.trim()).filter(e=>e.length>0).map(g):[]}function m(e){let{selectedCategories:t,selectedStates:r,selectedSuppliers:a,selectedRetailers:p,onStatesLoaded:g,onRetailersLoaded:m,onSuppliersLoaded:u,onRetailerSummary:h,onAddStop:f}=e,y=(0,l.useRef)(null),b=(0,l.useRef)(null),j=n.env.NEXT_PUBLIC_GEOJSON_URL||"".concat("/certis_agroute_app","/retailers.geojson");return(0,l.useEffect)(()=>{if(b.current)return;let e=new(i()).Map({container:y.current,style:"mapbox://styles/mapbox/satellite-streets-v12",center:[-98.5795,39.8283],zoom:4,projection:"mercator"});b.current=e,e.on("load",async()=>{try{let c=await fetch(j),p=await c.json(),h=new Set,y=new Set,b=new Map,N=new Set;for(let e of p.features){var t,s,l;let r=null===(t=e.properties)||void 0===t?void 0:t.State,a=null===(s=e.properties)||void 0===s?void 0:s["Long Name"],i=null===(l=e.properties)||void 0===l?void 0:l.Suppliers;if(r&&h.add(r),a&&(y.add(a),r)){let e=d(r);b.has(e)||b.set(e,new Set),b.get(e).add(a)}x(i).forEach(e=>N.add(e))}if(null==g||g(Array.from(h).sort()),null==u||u(Array.from(N).sort()),m){let e;if(0===r.length)e=Array.from(y).sort();else{let t=r.map(d),s=new Set;for(let[e,r]of b.entries())if(t.includes(e))for(let e of r)s.add(e);e=Array.from(s).sort()}m(e)}e.addSource("retailers",{type:"geojson",data:p}),e.addLayer({id:"retailers-layer",type:"circle",source:"retailers",paint:{"circle-radius":4,"circle-color":["match",["get","Category"],"Agronomy",o.Agronomy.color,"Grain/Feed",o["Grain/Feed"].color,"Office/Service",o["Office/Service"].color,"#1d4ed8"],"circle-stroke-width":2,"circle-stroke-color":"#fff"},filter:["!=",["get","Category"],"Kingpin"]}),e.addLayer({id:"kingpins-layer",type:"circle",source:"retailers",paint:{"circle-radius":7,"circle-color":o.Kingpin.color,"circle-stroke-width":2,"circle-stroke-color":o.Kingpin.outline},filter:["==",["get","Category"],"Kingpin"]});let k=new(i()).Popup({closeButton:!1,closeOnClick:!1});function a(e){let t=e["Long Name"]||e.Retailer||"Unknown",r=e.Name||"",s=r?"".concat(t," – ").concat(r):t,l=x(e.Suppliers).join(", ")||"N/A",a="add-stop-".concat(Math.random().toString(36).slice(2)),i='\n            <div style="font-size: 13px; background:#1a1a1a; color:#f5f5f5; padding:6px; border-radius:4px; position:relative;">\n              <button id="'.concat(a,'" style="position:absolute; top:4px; right:4px; padding:2px 6px; background:#2563eb; color:#fff; border:none; border-radius:3px; font-size:11px; cursor:pointer;">\n                ➕ Add to Trip\n              </button>\n              <strong>').concat(t,"</strong><br/>\n              <em>").concat(r,"</em><br/>\n              ").concat(e.Address||""," ").concat(e.City||""," ").concat(e.State||""," ").concat(e.Zip||"","<br/>\n              Suppliers: ").concat(l,"\n            </div>\n          ");return setTimeout(()=>{let e=document.getElementById(a);e&&f&&e.addEventListener("click",()=>f(s))},0),i}function n(t){e.on("mouseenter",t,t=>{var r,s;e.getCanvas().style.cursor="pointer";let l=null===(r=t.features)||void 0===r?void 0:r[0].geometry,i=null==l?void 0:l.coordinates.slice(),n=null===(s=t.features)||void 0===s?void 0:s[0].properties;i&&n&&k.setLngLat(i).setHTML(a(n)).addTo(e)}),e.on("mouseleave",t,()=>{e.getCanvas().style.cursor="",k.remove()}),e.on("click",t,t=>{var r,s;let l=null===(r=t.features)||void 0===r?void 0:r[0].geometry,n=null==l?void 0:l.coordinates.slice(),o=null===(s=t.features)||void 0===s?void 0:s[0].properties;n&&o&&new(i()).Popup().setLngLat(n).setHTML(a(o)).addTo(e)})}n("retailers-layer"),n("kingpins-layer")}catch(e){console.error("Failed to load GeoJSON",e)}})},[j,g,m,u,r,f]),(0,l.useEffect)(()=>{if(!b.current)return;let e=b.current.getSource("retailers");e&&fetch(j).then(e=>e.json()).then(s=>{let l={type:"FeatureCollection",features:s.features.filter(e=>{let s=e.properties||{};if("Kingpin"===s.Category)return!0;let l=0===r.length||r.map(d).includes(d(s.State)),i=0===p.length||p.map(d).includes(d(s["Long Name"])),n=0===t.length||t.map(c).includes(c(s.Category)),o=x(s.Suppliers).map(d),g=0===a.length||a.map(d).some(e=>o.includes(e));return l&&i&&n&&g})};if(e.setData(l),h){let e=new Map;for(let t of l.features){let r=t.properties||{};if("Kingpin"===r.Category)continue;let s=r.State||"Unknown",l=r["Long Name"]||r.Retailer||"Unknown",a=x(r.Suppliers),i="".concat(s,"-").concat(l);e.has(i)||e.set(i,{state:s,retailer:l,count:0,suppliers:[]});let n=e.get(i);for(let e of(n.count+=1,a))e&&!n.suppliers.includes(e)&&n.suppliers.push(e)}h(Array.from(e.values()))}})},[j,r,p,t,a,h]),(0,s.jsx)("div",{ref:y,className:"w-full h-full"})}var u=r(6648),h=r(4697),f=r(2873);let y=e=>(e||"").toString().trim().toLowerCase();function b(){let[e,t]=(0,l.useState)([]),[r,a]=(0,l.useState)([]),[i,n]=(0,l.useState)([]),[c,d]=(0,l.useState)([]),[p,g]=(0,l.useState)([]),[x,b]=(0,l.useState)([]),[j,N]=(0,l.useState)([]),[k,v]=(0,l.useState)([]),[w,S]=(0,l.useState)(!1),[C,L]=(0,l.useState)([]),A=e=>{let t=y(e);d(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},F=e=>{let t=y(e);g(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},E=e=>{b(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},O=e=>{let t=y(e);N(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])};k.filter(e=>"kingpin"===y(e.retailer)||"kingpin"===y(e.category||""));let T=k.filter(e=>"kingpin"!==y(e.retailer)&&"kingpin"!==y(e.category||""));return(0,s.jsxs)("div",{className:"flex h-screen w-screen relative",children:[(0,s.jsx)("button",{className:"absolute top-3 left-3 z-20 p-2 bg-gray-800 text-white rounded-md md:hidden",onClick:()=>S(!w),"aria-label":"Toggle sidebar",children:w?(0,s.jsx)(h.Z,{size:20}):(0,s.jsx)(f.Z,{size:20})}),(0,s.jsxs)("aside",{className:"fixed md:static top-0 left-0 h-full w-72 bg-gray-100 dark:bg-gray-900 p-4 border-r border-gray-300 dark:border-gray-700 overflow-y-auto z-10 transform transition-transform duration-300\n        ".concat(w?"translate-x-0":"-translate-x-full"," md:translate-x-0"),children:[(0,s.jsx)("div",{className:"flex items-center justify-center mb-6",children:(0,s.jsx)(u.default,{src:"".concat("/certis_agroute_app","/certis-logo.png"),alt:"Certis Logo",width:180,height:60,priority:!0})}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Home Zip Code"}),(0,s.jsx)("input",{type:"text",placeholder:"Enter ZIP",className:"w-full p-2 rounded border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100"})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"State Filter"}),(0,s.jsxs)("div",{className:"flex space-x-2 mb-3",children:[(0,s.jsx)("button",{onClick:()=>{g(e.map(y))},className:"px-2 py-1 bg-blue-600 text-white rounded text-sm",children:"Select All"}),(0,s.jsx)("button",{onClick:()=>{g([])},className:"px-2 py-1 bg-gray-600 text-white rounded text-sm",children:"Clear All"})]}),(0,s.jsx)("div",{className:"grid grid-cols-3 gap-2",children:e.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-1",children:[(0,s.jsx)("input",{type:"checkbox",checked:p.includes(y(e)),onChange:()=>F(e),className:"mr-1"}),(0,s.jsx)("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:e})]},e))})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Retailer Filter"}),(0,s.jsx)("div",{className:"flex space-x-2 mb-3",children:(0,s.jsx)("button",{onClick:()=>{N([])},className:"px-2 py-1 bg-gray-600 text-white rounded text-sm",children:"Clear All"})}),(0,s.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:r.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:j.includes(y(e)),onChange:()=>O(e)}),(0,s.jsx)("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:e})]},e))})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Supplier Filter"}),(0,s.jsx)("div",{className:"flex space-x-2 mb-3",children:(0,s.jsx)("button",{onClick:()=>{b([])},className:"px-2 py-1 bg-gray-600 text-white rounded text-sm",children:"Clear All"})}),(0,s.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:i.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:x.includes(e),onChange:()=>E(e)}),(0,s.jsx)("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:e})]},e))})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Categories"}),(0,s.jsxs)("div",{className:"flex space-x-2 mb-4",children:[(0,s.jsx)("button",{onClick:()=>{d(Object.keys(o).filter(e=>"Kingpin"!==e).map(y))},className:"px-2 py-1 bg-blue-600 text-white rounded text-sm",children:"Select All"}),(0,s.jsx)("button",{onClick:()=>{d([])},className:"px-2 py-1 bg-gray-600 text-white rounded text-sm",children:"Clear All"})]}),(0,s.jsx)("ul",{className:"space-y-2",children:Object.entries(o).map(e=>{let[t,r]=e;return(0,s.jsx)("li",{className:"flex items-center",children:"Kingpin"!==t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{type:"checkbox",id:"filter-".concat(t),checked:c.includes(y(t)),onChange:()=>A(t),className:"mr-2"}),(0,s.jsxs)("label",{htmlFor:"filter-".concat(t),className:"flex items-center text-gray-700 dark:text-gray-300",children:[(0,s.jsx)("span",{className:"inline-block w-4 h-4 mr-2 rounded-full border",style:{backgroundColor:r.color,borderColor:r.outline||"#000"}}),t]})]}):(0,s.jsxs)("div",{className:"flex items-center text-gray-700 dark:text-gray-300 ml-1",children:[(0,s.jsx)("span",{className:"inline-block w-4 h-4 mr-2 rounded-full border",style:{backgroundColor:r.color,borderColor:r.outline||"#000"}}),t]})},t)})}),(0,s.jsx)("p",{className:"mt-3 text-sm text-red-600 dark:text-yellow-400 font-semibold",children:"Kingpins are always visible (bright red, yellow border)."})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Channel Summary"}),(0,s.jsxs)("div",{className:"text-sm text-gray-700 dark:text-gray-300 space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("strong",{children:["States Selected (",p.length,"):"]})," ",p.length>0?p.join(", "):"None"]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("strong",{children:["Retailers Selected (",j.length,"):"]}),j.length>0?(0,s.jsx)("ul",{className:"list-disc ml-5",children:r.filter(e=>j.includes(y(e))).map((e,t)=>(0,s.jsx)("li",{children:e},t))}):" None"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Location Summaries:"}),T.length>0?(0,s.jsx)("ul",{className:"list-disc ml-5",children:T.map((e,t)=>(0,s.jsxs)("li",{children:[e.retailer," – ",e.count," locations"]},t))}):" None"]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Supplier Summaries:"}),T.length>0?(0,s.jsx)("ul",{className:"list-disc ml-5",children:T.map((e,t)=>(0,s.jsxs)("li",{children:[e.retailer," –"," ",e.suppliers&&e.suppliers.length>0?e.suppliers.join(", "):"N/A"]},t))}):" None"]})]})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[(0,s.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Trip Optimization"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"Selected stops will appear below:"}),C.length>0?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("ol",{className:"list-decimal ml-5 text-sm text-gray-700 dark:text-gray-300",children:C.map((e,t)=>(0,s.jsx)("li",{children:e},t))}),(0,s.jsx)("button",{onClick:()=>L([]),className:"mt-2 px-2 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700",children:"Clear All"})]}):(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No stops added yet."})]})]}),(0,s.jsx)("main",{className:"flex-1 relative",children:(0,s.jsx)(m,{selectedCategories:c,selectedStates:p,selectedSuppliers:x,selectedRetailers:j,onStatesLoaded:t,onRetailersLoaded:a,onSuppliersLoaded:n,onRetailerSummary:v,onAddStop:e=>{C.includes(e)||L(t=>[...t,e])}})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[415,758,130,215,744],()=>t(2791)),_N_E=e.O()}]);