(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4096:(e,t,r)=>{Promise.resolve().then(r.bind(r,8235))},5255:(e,t,r)=>{"use strict";r.d(t,{AQ:()=>i,Ay:()=>p,Bi:()=>s,Jk:()=>o,OF:()=>l,Zc:()=>c,kR:()=>d});var a=r(5155),n=r(2115);let i="certis_trip_print_payload_v2",l="certis_app_state_v1",o=["cad_trip_print_payload_v2"],s=["cad_app_state_v1"];function c(e){return d(i,e)}function d(e,t){let r=String(t||"").trim().replace(/[^a-zA-Z0-9_-]/g,"").slice(0,64);return r?"".concat(e,"__").concat(r):e}function u(e){return String(null!=e?e:"").trim()}function p(e){let t=e.tripStops.length>=1,r=(0,n.useMemo)(()=>c(e.pid||""),[e.pid]),l=(0,n.useMemo)(()=>{let t=e.tripStops.map((e,t)=>({idx:t+1,id:u(e.id),label:u(e.label),retailer:u(e.retailer),name:u(e.name),address:u(e.address),city:u(e.city),state:u(e.state),zip:u(e.zip),kind:u(e.kind),email:u(e.email),phoneOffice:u(e.phoneOffice),phoneCell:u(e.phoneCell)})),r=(e.routeLegs||[]).map(e=>({fromLabel:u(e.fromLabel),toLabel:u(e.toLabel),distanceMeters:Number(e.distanceMeters||0),durationSeconds:Number(e.durationSeconds||0)})),a=e.routeTotals?{distanceMeters:Number(e.routeTotals.distanceMeters||0),durationSeconds:Number(e.routeTotals.durationSeconds||0)}:null,n=(e.channelSummaryRows||[]).map(e=>({retailer:u(e.retailer),tripStops:Number(e.tripStops||0),totalLocations:Number(e.totalLocations||0),agronomyLocations:Number(e.agronomyLocations||0),suppliers:Array.isArray(e.suppliers)?e.suppliers.map(u).filter(Boolean):[],categoryBreakdown:Array.isArray(e.categoryBreakdown)?e.categoryBreakdown.map(u).filter(Boolean):[],states:Array.isArray(e.states)?e.states.map(u).filter(Boolean):[]}));return{v:2,pid:u(e.pid||""),generatedAt:u(e.generatedAt),basePath:u(e.basePath),home:{label:u(e.homeLabel),zip:u(e.homeZip),coords:e.homeCoords?[Number(e.homeCoords[0]),Number(e.homeCoords[1])]:null},stops:t,legs:r,totals:a,channelSummary:n}},[e.generatedAt,e.basePath,e.pid,e.homeLabel,e.homeZip,e.homeCoords,e.tripStops,e.routeLegs,e.routeTotals,e.channelSummaryRows]);return(0,a.jsxs)("div",{className:"rounded-xl border ring-1 backdrop-blur-sm p-3 bg-[linear-gradient(180deg,rgba(59,130,246,0.14),rgba(8,20,45,0.12))] border-[color:rgba(165,243,252,0.16)] ring-[color:rgba(147,197,253,0.10)] shadow-[0_14px_30px_rgba(0,0,0,0.45)]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("div",{className:"text-sm font-extrabold leading-tight text-yellow-300",children:"Print Trip (PDF)"}),(0,a.jsx)("div",{className:"text-[11px] text-white/60 whitespace-nowrap",children:t?"Ready":"Add ≥ 1 stop"})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{if(!t)return;try{let t=JSON.stringify(l);for(let a of(localStorage.setItem(r,t),sessionStorage.setItem(r,t),localStorage.setItem(i,t),sessionStorage.setItem(i,t),o)){let r=d(a,e.pid||"");localStorage.setItem(r,t),sessionStorage.setItem(r,t),localStorage.setItem(a,t),sessionStorage.setItem(a,t)}}catch(e){}let a="".concat(e.basePath,"/print").concat(e.pid?"?pid=".concat(encodeURIComponent(e.pid)):"");window.open(a,"_blank","noopener,noreferrer")||window.location.assign(a)},disabled:!t,className:["mt-2 w-full rounded-xl px-4 py-2 text-sm font-extrabold",t?"bg-[#fde047] text-black hover:bg-[#fde047]/90":"bg-white/10 text-white/40 cursor-not-allowed"].join(" "),children:"Print / Save as PDF"}),(0,a.jsxs)("div",{className:"mt-2 text-[12px] text-white/70 leading-snug",children:["Opens an ink-safe print view in a ",(0,a.jsx)("span",{className:"font-semibold text-white/90",children:"new tab"}),". Your trip stays loaded here."]}),e.routeTotals&&(0,a.jsxs)("div",{className:"mt-2 text-[11px] text-white/60",children:["Route total:"," ",(0,a.jsxs)("span",{className:"text-white/80 font-semibold",children:[function(e){let t=e/1609.344;return isFinite(t)?t<.1?"<0.1 mi":t<10?"".concat(t.toFixed(1)," mi"):"".concat(t.toFixed(0)," mi"):"—"}(e.routeTotals.distanceMeters)," • ",function(e){let t=e/60;if(!isFinite(t))return"—";if(t<1)return"<1 min";if(t<60)return"".concat(Math.round(t)," min");let r=Math.floor(t/60),a=Math.round(t-60*r);return"".concat(r,"h ").concat(a,"m")}(e.routeTotals.durationSeconds)]})]})]})}},8235:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>G});var a=r(5155),n=r(2115),i=r(5411),l=r.n(i);let o=[-95.9345,41.2565],s=[[-127,23],[-65,51]],c="retailers",d="kingpins",u="trip-route-src",p="retailers-circle",m="corp-hq-circle",g="kingpin-symbol",h="trip-route",x="retailers-hitbox",f="hq-hitbox",v="kingpin-hitbox",b="Agronomy",y="Grain/Feed",w="C-Store/Service/Energy",j="Distribution",N="Regional HQ",k=[b,y,w,j,N];function S(e){return String(null!=e?e:"").trim()}function C(e){return Array.from(new Set(e.filter(Boolean))).sort((e,t)=>e.localeCompare(t))}function L(e){let t=S(e).toLowerCase();if(!t)return!1;let r=t.includes("hq"),a=t.includes("corporate"),n=t.includes("regional");return r&&(a||n)||"hq"===t}function R(e,t,r){let a=S(r.Retailer),n=S(r.Name),i=S(r.State),l=S(r.Zip);return"".concat(e,":").concat(a,"|").concat(n,"|").concat(i,"|").concat(l,"|").concat(t[0].toFixed(6),",").concat(t[1].toFixed(6))}function A(e){return"".concat(e,"-").concat(Math.random().toString(16).slice(2),"-").concat(Date.now().toString(16))}async function T(e,t,r){let a=Math.max(8,Math.round(t*r)),n=Math.max(8,Math.round(t*r)),i=document.createElement("canvas");i.width=a,i.height=n;let l=i.getContext("2d");if(!l)throw Error("2D context not available");l.imageSmoothingEnabled=!0;let o=document.createElement("img");o.decoding="async";let s=function(e){let t=new Blob([e],{type:"image/svg+xml;charset=utf-8"});return URL.createObjectURL(t)}(e);o.src=s,await new Promise((e,t)=>{o.onload=()=>e(),o.onerror=()=>t(Error("SVG image load failed"))}).finally(()=>{try{URL.revokeObjectURL(s)}catch(e){}}),l.clearRect(0,0,a,n),l.drawImage(o,0,0,a,n);let c=l.getImageData(0,0,a,n);return{width:a,height:n,data:c.data}}function F(e){return e.features&&e.features.length?e.features:[]}function _(e){var t,r,a;let n=null!==(r=null==e?void 0:e.properties)&&void 0!==r?r:{},i=null!==(a=null==e?void 0:null===(t=e.geometry)||void 0===t?void 0:t.coordinates)&&void 0!==a?a:null;if(!i)return null;let l=S(n.Retailer),o=S(n.ContactName||n.Name||n.Contact||n["Contact Name"])||"Kingpin",s=l?"".concat(o," — ").concat(l):"".concat(o),c=S(n.Category),d=L(c)?N:c||"Kingpin";return{id:R("kingpin",i,n),kind:"kingpin",label:s,retailer:l,name:o,address:S(n.Address),city:S(n.City),state:S(n.State),zip:S(n.Zip),category:d,suppliers:S(n.Suppliers),email:S(n.Email)||"TBD",phoneOffice:S(n.OfficePhone||n["Office Phone"]||n.PhoneOffice)||"TBD",phoneCell:S(n.CellPhone||n["Cell Phone"]||n.PhoneCell)||"TBD",coords:i}}function M(e){let{selectedStates:t,selectedRetailers:r,selectedCategories:i,selectedSuppliers:M,homeCoords:E,tripStops:z,zoomToStop:P,onStatesLoaded:I,onRetailersLoaded:B,onCategoriesLoaded:O,onSuppliersLoaded:D,onAllStopsLoaded:Z,onAddStop:H,onRetailerNetworkSummaryLoaded:U}=e,J=(0,n.useRef)(null),q=(0,n.useRef)(null),G=(0,n.useRef)(null),K=(0,n.useRef)(null),Q=(0,n.useRef)(null),W=(0,n.useRef)(null),Y=(0,n.useRef)(""),X=(0,n.useRef)(null),V=(0,n.useRef)(""),$=(0,n.useRef)(!1),[ee,et]=(0,n.useState)("none"),er=(0,n.useRef)("none"),ea=(0,n.useRef)(null),en=(0,n.useRef)(!0),ei=(0,n.useMemo)(()=>"/certis_agroute_app".trim()||"/certis_agroute_app",[]),el=(0,n.useMemo)(()=>"pk.eyJ1IjoiZG9jamJhaWxleTE5NzEiLCJhIjoiY21ld3lzZTNqMGQwdzJxb2lwNHpjcjNveiJ9.T2O5szdwL-O5nDF9BJmFnw".trim()||"pk.eyJ1IjoiZG9jamJhaWxleTE5NzEiLCJhIjoiY21ld3lzZTNqMGQwdzJxb2lwNHpjcjNveiJ9.T2O5szdwL-O5nDF9BJmFnw".trim(),[]),eo=(0,n.useMemo)(()=>"kingpin-icon-".concat("K16"),[]),es=(0,n.useMemo)(()=>"star",[]),ec="#2563eb",ed="#0b1220",eu=(0,n.useMemo)(()=>"circle"===es?'\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 128 128">\n          <circle cx="64" cy="64" r="44" fill="'.concat(ec,'" stroke="').concat(ed,'" stroke-width="').concat(6,'"/>\n        </svg>\n      ').trim():'\n      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 128 128">\n        <path\n          d="M64 14\n             L78.6 47.5\n             L115 52.2\n             L88 75.1\n             L96.1 110\n             L64 92\n             L31.9 110\n             L40 75.1\n             L13 52.2\n             L49.4 47.5\n             Z"\n          fill="'.concat(ec,'"\n          stroke="').concat(ed,'"\n          stroke-width="').concat(6,'"\n          stroke-linejoin="round"\n        />\n      </svg>\n    ').trim(),[es,ec,ed,6]),ep=e=>{er.current!==e&&(er.current=e,et(e))};async function em(){var e,t,r,a,n,i,l;let o=q.current;if(!o)return;let[s,u]=await Promise.all([fetch("".concat(ei,"/data/retailers.geojson")),fetch("".concat(ei,"/data/kingpin.geojson"))]),p=await s.json(),m=await u.json(),g={...p,features:(null!==(e=p.features)&&void 0!==e?e:[]).map(e=>{var t;let r=null!==(t=e.properties)&&void 0!==t?t:{},a=function(e){let t=S(e),r=t.toLowerCase();if(!r)return"";if(L(t))return N;if(r.includes("agronomy"))return b;let a=r.includes("grain"),n=r.includes("feed");return a||n?y:r.includes("c-store")||r.includes("c store")||r.includes("service")||r.includes("energy")?w:r.includes("distribution")?j:""}(r.Category);return{...e,properties:{...r,Category:a||""}}})},h={...m,features:(null!==(t=m.features)&&void 0!==t?t:[]).map(e=>{var t,r;let[a,n]=null!==(r=null===(t=e.geometry)||void 0===t?void 0:t.coordinates)&&void 0!==r?r:[0,0];return{...e,geometry:{...e.geometry,coordinates:[a+.0013,n]}}})};if(G.current=g,K.current=h,o.getSource(c).setData(g),o.getSource(d).setData(h),U){let e=function(e){var t,r;let a={};for(let n of null!==(t=e.features)&&void 0!==t?t:[]){let e=null!==(r=n.properties)&&void 0!==r?r:{},t=S(e.Retailer)||"Unknown Retailer",i=S(e.State),l=S(e.Category),o=l===N;a[t]||(a[t]={total:0,agronomy:0,states:new Set,catCounts:new Map}),a[t].total+=1,i&&a[t].states.add(i);let s=l||"Uncategorized";a[t].catCounts.set(s,(a[t].catCounts.get(s)||0)+1),o||l!==b||(a[t].agronomy+=1)}let n=Object.entries(a).map(e=>{let[t,r]=e,a=Array.from(r.catCounts.entries()).map(e=>{let[t,r]=e;return{category:t,count:r}}).sort((e,t)=>t.count-e.count||e.category.localeCompare(t.category));return{retailer:t,totalLocations:r.total,agronomyLocations:r.agronomy,states:Array.from(r.states).sort(),categoryCounts:a}});return n.sort((e,t)=>t.totalLocations-e.totalLocations||e.retailer.localeCompare(t.retailer)),n}(g),t=e.slice(0,200).map(e=>"".concat(e.retailer,"|").concat(e.totalLocations,"|").concat(e.agronomyLocations,"|").concat(e.states.join("/"))).join(";");if(t!==V.current){V.current=t;try{U(e)}catch(e){console.warn("[CertisMap] onRetailerNetworkSummaryLoaded failed:",e)}}}let x=[];for(let e of null!==(r=g.features)&&void 0!==r?r:[]){let t=null!==(n=e.properties)&&void 0!==n?n:{},r=null===(a=e.geometry)||void 0===a?void 0:a.coordinates;if(!r)continue;let i=S(t.Category),l=i===N?"hq":"retailer",o=S(t.Retailer),s=S(t.Name),c="hq"===l?"".concat(o||"Regional HQ"," — Regional HQ"):"".concat(o||"Retailer"," — ").concat(s||"Site");x.push({id:R(l,r,t),kind:l,label:c,retailer:o,name:s,address:S(t.Address),city:S(t.City),state:S(t.State),zip:S(t.Zip),category:i,suppliers:S(t.Suppliers),coords:r})}for(let e of null!==(i=h.features)&&void 0!==i?i:[]){let t=_(e);t&&x.push(t)}Z(x),I(C(x.map(e=>S(e.state).toUpperCase()).filter(Boolean))),B(C((null!==(l=g.features)&&void 0!==l?l:[]).map(e=>{var t;return S(null===(t=e.properties)||void 0===t?void 0:t.Retailer)}).filter(Boolean))),O([...k]),D(C(x.flatMap(e=>(function(e){let t=S(e);return t?t.split(/[;,|]/g).map(e=>e.trim()).filter(Boolean):[]})(e.suppliers))))}function eg(){let e=q.current,a=G.current;if(!e||!a)return;let n=["all"];n.push(["!=",["get","Category"],N]),t.length&&n.push(["in",["upcase",["get","State"]],["literal",t]]),r.length&&n.push(["in",["get","Retailer"],["literal",r]]),i.length&&n.push(["in",["get","Category"],["literal",i]]),M.length&&n.push(["any",...M.map(e=>[">=",["index-of",e.toLowerCase(),["downcase",["get","Suppliers"]]],0])]);let l=["all"];l.push(["==",["get","Category"],N]),t.length&&l.push(["in",["upcase",["get","State"]],["literal",t]]),e.setFilter(p,n),e.setFilter(x,n),e.setFilter(m,l),e.setFilter(f,l)}async function eh(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=q.current;if(!t)return;let r=t.getSource(u);if(!r)return;let a=function(){let e=[];for(let t of(E&&Array.isArray(E)&&2===E.length&&e.push(E),z||[]))(null==t?void 0:t.coords)&&Array.isArray(t.coords)&&2===t.coords.length&&e.push(t.coords);return e}();if(a.length<2){r.setData({type:"FeatureCollection",features:[]}),Y.current="",ep("none");return}let n=a.map(e=>"".concat(e[0].toFixed(6),",").concat(e[1].toFixed(6))).join("|");(e||n!==Y.current)&&(Y.current=n,W.current&&window.clearTimeout(W.current),W.current=window.setTimeout(async()=>{var e,t,n;try{null===(e=Q.current)||void 0===e||e.abort()}catch(e){}let i=new AbortController;Q.current=i;let l=a.map(e=>"".concat(e[0],",").concat(e[1])).join(";"),o="https://api.mapbox.com/directions/v5/mapbox/driving/".concat(l)+"?geometries=geojson&overview=full&steps=false&access_token=".concat(encodeURIComponent(el));try{let e=await fetch(o,{signal:i.signal});if(!e.ok)throw Error("Directions HTTP ".concat(e.status," ").concat(e.statusText));let a=await e.json(),l=null==a?void 0:null===(n=a.routes)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.geometry;if(!l||"LineString"!==l.type)throw Error("Directions missing geometry");r.setData({type:"FeatureCollection",features:[{type:"Feature",geometry:l,properties:{}}]}),ep("roads")}catch(e){if((null==e?void 0:e.name)==="AbortError")return;r.setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:a},properties:{fallback:!0}}]}),ep("fallback")}},150))}function ex(e,t){let r=q.current;if(!r)return null;!function(){try{var e;null===(e=ea.current)||void 0===e||e.remove()}catch(e){}ea.current=null}();let a=new(l()).Popup({offset:14,closeOnMove:!1,closeButton:!1}).setLngLat(e).setHTML(t).addTo(r);return ea.current=a,a}function ef(e){var t,r,a;let n=q.current;if(!n)return;let i=F(e);if(i&&0!==i.length||(i=n.queryRenderedFeatures(e.point,{layers:[x,f]}))&&0!==i.length||(i=n.queryRenderedFeatures(e.point,{layers:[p,m]})),!i||0===i.length)return;let l=i[0],o=null!==(r=l.properties)&&void 0!==r?r:{},s=null!==(a=null===(t=l.geometry)||void 0===t?void 0:t.coordinates)&&void 0!==a?a:[],c=S(o.Retailer),d=S(o.Name),u=S(o.Address),g=S(o.City),h=S(o.State),v=S(o.Zip),b=S(o.Category),y=S(o.Suppliers)||"Not listed",w=b===N?"hq":"retailer",j={id:R(w,s,o),kind:w,label:"hq"===w?"".concat(c||"Regional HQ"," — Regional HQ"):"".concat(c||"Retailer"," — ").concat(d||"Site"),retailer:c,name:d,address:u,city:g,state:h,zip:v,category:b,suppliers:y,coords:s},k="hq"===w?"".concat(c||"Regional HQ"," — Regional HQ"):c||"Unknown Retailer",C=A("add-stop");ex(s,'\n      <div style="font-size:13px;min-width:300px;max-width:320px;color:#fff;line-height:1.3;font-family:Segoe UI,Arial;">\n        <div style="font-size:15px;font-weight:700;margin-bottom:4px;color:#facc15;">'.concat(k,"</div>\n        ").concat(d?'<div style="font-style:italic;margin-bottom:4px;">'.concat(d,"</div>"):"",'\n        <div style="margin-bottom:4px;">').concat(u,"<br/>").concat(g,", ").concat(h," ").concat(v,"</div>\n        ").concat(b?'<div style="margin-bottom:6px;"><span style="font-weight:700;color:#facc15;">Category:</span> '.concat(b,"</div>"):"",'\n        <div style="margin-bottom:8px;"><span style="font-weight:700;color:#facc15;">Suppliers:</span> ').concat(y,'</div>\n        <button id="').concat(C,'" style="padding:7px 10px;border:none;background:#facc15;border-radius:5px;font-weight:700;font-size:13px;color:#111827;cursor:pointer;width:100%;">\n          ➕ Add to Trip\n        </button>\n      </div>\n    ')),setTimeout(()=>{let e=document.getElementById(C);e&&(e.onclick=()=>H(j))},0)}function ev(e){let t=q.current;if(!t)return;let r=F(e);if(r&&0!==r.length||(r=t.queryRenderedFeatures(e.point,{layers:[v]}))&&0!==r.length||(r=t.queryRenderedFeatures(e.point,{layers:[g]})),!r||0===r.length)return;let a=[e.lngLat.lng,e.lngLat.lat],n=(r||[]).filter(Boolean).map(e=>{var t,r,n;let i=null!==(r=null===(t=e.geometry)||void 0===t?void 0:t.coordinates)&&void 0!==r?r:null,l=null!==(n=e.properties)&&void 0!==n?n:{};return i?{f:e,coords:i,p:l,d:function(e,t){let r=e[0]-t[0],a=e[1]-t[1];return r*r+a*a}(a,i),label:function(e){let t=S(e.ContactName||e.Name||e.Contact||e["Contact Name"])||"Kingpin",r=S(e.Retailer),a=[S(e.City),S(e.State)].filter(Boolean).join(", ");return r&&a?"".concat(t," — ").concat(r," (").concat(a,")"):r?"".concat(t," — ").concat(r):a?"".concat(t," (").concat(a,")"):t}(l),key:function(e,t){let r=S(e.Retailer),a=S(e.ContactName||e.Name||e.Contact||e["Contact Name"]),n=S(e.Email),i=S(e.CellPhone||e["Cell Phone"]||e.PhoneCell),l=S(e.OfficePhone||e["Office Phone"]||e.PhoneOffice),o=S(e.City),s=[a,r,n,i,l,o,S(e.State),S(e.Zip)].filter(Boolean).join("|");return s||"".concat(t[0].toFixed(6),",").concat(t[1].toFixed(6),"|").concat(r,"|").concat(a)}(l,i)}:null}).filter(Boolean),i={};for(let e of n)(!i[e.key]||e.d<i[e.key].d)&&(i[e.key]=e);let l=Object.values(i).sort((e,t)=>e.d-t.d||e.label.localeCompare(t.label));if(!l.length)return;let o=l[0],s=o.coords,c=A("kp-select"),d=A("kp-add"),u=l.length>1,p=_(o.f);if(!p)return;let m=S(o.p.Retailer)||"Unknown Retailer",h=S(o.p.ContactTitle||o.p.Title||o.p["Contact Title"]||""),x=l.map((e,t)=>{let r=e.label.replace(/</g,"&lt;").replace(/>/g,"&gt;"),a=e.key.replace(/"/g,"&quot;");return'<option value="'.concat(a,'"').concat(0===t?' selected="selected"':"",">").concat(r,"</option>")}).join(""),f=u?'\n        <div style="margin:8px 0 10px 0;">\n          <div style="font-size:12px;font-weight:700;color:#facc15;margin-bottom:4px;">Multiple Kingpins here</div>\n          <select id="'.concat(c,'" style="width:100%;padding:8px 10px;border-radius:6px;border:1px solid rgba(255,255,255,0.2);background:#0b1220;color:#fff;font-size:13px;">\n            ').concat(x,"\n          </select>\n        </div>\n      "):"";ex(s,'\n      <div style="font-size:13px;min-width:320px;max-width:380px;color:#fff;line-height:1.3;font-family:Segoe UI,Arial;">\n        <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:10px;">\n          <div>\n            <div style="font-size:16px;font-weight:800;margin-bottom:6px;color:#facc15;">'.concat(m,'</div>\n          </div>\n          <div style="opacity:0.7;font-weight:700;">KP</div>\n        </div>\n\n        ').concat(f,'\n\n        <div id="kp-details">\n          <div style="font-weight:800;margin-bottom:2px;">').concat((p.name||"Kingpin").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"</div>\n          ").concat(h?'<div style="margin-bottom:4px;">'.concat(h.replace(/</g,"&lt;").replace(/>/g,"&gt;"),"</div>"):"",'\n          <div style="margin-bottom:6px;">').concat(S(p.address).replace(/</g,"&lt;").replace(/>/g,"&gt;"),"<br/>").concat(S(p.city),", ").concat(S(p.state)," ").concat(S(p.zip),"</div>\n\n          ").concat(p.category?'<div style="margin-bottom:6px;"><span style="font-weight:800;color:#facc15;">Category:</span> '.concat(S(p.category).replace(/</g,"&lt;").replace(/>/g,"&gt;"),"</div>"):"",'\n\n          <div style="margin-bottom:8px;"><span style="font-weight:800;color:#facc15;">Suppliers:</span> ').concat(S(p.suppliers).trim()?S(p.suppliers).replace(/</g,"&lt;").replace(/>/g,"&gt;"):"Not listed",'</div>\n\n          <div style="margin-bottom:4px;">Office: ').concat(S(p.phoneOffice)," • Cell: ").concat(S(p.phoneCell),'</div>\n          <div style="margin-bottom:10px;">Email: ').concat(S(p.email),'</div>\n        </div>\n\n        <button id="').concat(d,'" style="padding:7px 10px;border:none;background:#facc15;border-radius:6px;font-weight:900;font-size:13px;color:#111827;cursor:pointer;width:100%;">\n          ➕ Add to Trip\n        </button>\n      </div>\n    ')),setTimeout(()=>{let e=o,t=e=>{var t;let r=_(e.f);if(!r)return;let a=null!==(t=e.p)&&void 0!==t?t:{},n=S(a.ContactTitle||a.Title||a["Contact Title"]||""),i=document.getElementById("kp-details");if(!i)return;let l=e=>S(e).replace(/</g,"&lt;").replace(/>/g,"&gt;");i.innerHTML='\n          <div style="font-weight:800;margin-bottom:2px;">'.concat(l(r.name||"Kingpin"),"</div>\n          ").concat(n?'<div style="margin-bottom:4px;">'.concat(l(n),"</div>"):"",'\n          <div style="margin-bottom:6px;">').concat(l(r.address||""),"<br/>").concat(l(r.city||""),", ").concat(l(r.state||"")," ").concat(l(r.zip||""),"</div>\n          ").concat(r.category?'<div style="margin-bottom:6px;"><span style="font-weight:800;color:#facc15;">Category:</span> '.concat(l(r.category),"</div>"):"",'\n          <div style="margin-bottom:8px;"><span style="font-weight:800;color:#facc15;">Suppliers:</span> ').concat(l(r.suppliers||"").trim()?l(r.suppliers||""):"Not listed",'</div>\n          <div style="margin-bottom:4px;">Office: ').concat(l(r.phoneOffice||"TBD")," • Cell: ").concat(l(r.phoneCell||"TBD"),'</div>\n          <div style="margin-bottom:10px;">Email: ').concat(l(r.email||"TBD"),"</div>\n        ");let o=document.getElementById(d);o&&(o.onclick=()=>H(r))};if(t(o),u){let r=document.getElementById(c);r&&(r.onchange=()=>{let a=r.value,n=l.find(e=>e.key===a);n&&(e=n,t(n))})}let r=document.getElementById(d);r&&(r.onclick=()=>{let t=_(e.f);t&&H(t)})},0)}return(0,n.useEffect)(()=>{l().accessToken||(l().accessToken=el)},[el]),(0,n.useEffect)(()=>{if(!J.current||q.current)return;let e=new(l()).Map({container:J.current,style:"mapbox://styles/mapbox/satellite-streets-v12",center:o,zoom:6.8,projection:{name:"mercator"},maxBounds:s});q.current=e,e.addControl(new(l()).NavigationControl({showCompass:!0}),"top-right");try{X.current=new ResizeObserver(()=>{let e=q.current;e&&requestAnimationFrame(()=>{try{e.resize()}catch(e){}})}),X.current.observe(J.current)}catch(e){}let t=()=>{let e=q.current;e&&window.setTimeout(()=>{try{e.resize()}catch(e){}},60)};window.addEventListener("resize",t,{passive:!0}),window.addEventListener("orientationchange",t,{passive:!0});let r=async()=>{let e=q.current;if(e&&!e.hasImage(eo)){try{let t=await T(eu,64,2);e.addImage(eo,t);return}catch(e){console.warn("[CertisMap] SVG→Canvas kingpin icon failed; falling back to PNG.",e)}try{let t="".concat(ei,"/icons/kingpin.png?v=").concat(encodeURIComponent("K16")),r=await new Promise((r,a)=>{e.loadImage(t,(e,t)=>{if(e||!t)return a(e||Error("loadImage failed"));r(t)})});e.addImage(eo,r,{sdf:!1})}catch(e){console.error("[CertisMap] PNG fallback kingpin icon also failed:",e)}}};return e.on("load",async()=>{e.getSource(c)||e.addSource(c,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),e.getSource(d)||e.addSource(d,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),e.getSource(u)||e.addSource(u,{type:"geojson",data:{type:"FeatureCollection",features:[]}}),e.getLayer(p)||e.addLayer({id:p,type:"circle",source:c,paint:{"circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#111827","circle-color":["case",["==",["get","Category"],b],"#22c55e",["==",["get","Category"],y],"#f97316",["==",["get","Category"],w],"#0ea5e9",["==",["get","Category"],j],"#a855f7","#f9fafb"]}}),e.getLayer(x)||e.addLayer({id:x,type:"circle",source:c,paint:{"circle-radius":["interpolate",["linear"],["zoom"],3,10,5,14,7,18,10,20],"circle-color":"#000000","circle-opacity":.001,"circle-stroke-width":0}}),e.getLayer(m)||e.addLayer({id:m,type:"circle",source:c,filter:["==",["get","Category"],N],paint:{"circle-radius":6,"circle-color":"#ff0000","circle-stroke-color":"#facc15","circle-stroke-width":2}}),e.getLayer(f)||e.addLayer({id:f,type:"circle",source:c,filter:["==",["get","Category"],N],paint:{"circle-radius":["interpolate",["linear"],["zoom"],3,12,5,16,7,20,10,22],"circle-color":"#000000","circle-opacity":.001,"circle-stroke-width":0}}),await r(),e.getLayer(g)||e.addLayer({id:g,type:"symbol",source:d,layout:{"icon-image":eo,"icon-size":["interpolate",["linear"],["zoom"],3,.18,5,.2,7,.22,9,.24,11,.25,13,.26,15,.26,17,.26],"icon-anchor":"center","icon-allow-overlap":!0,"icon-ignore-placement":!0}}),e.getLayer(v)||e.addLayer({id:v,type:"circle",source:d,paint:{"circle-radius":["interpolate",["linear"],["zoom"],3,18,5,20,7,22,10,24,12,26],"circle-color":"#000000","circle-opacity":.001,"circle-stroke-width":0}}),e.getLayer(h)||e.addLayer({id:h,type:"line",source:u,paint:{"line-color":"#facc15","line-width":4,"line-opacity":.95}}),$.current||($.current=!0,await em()),eg(),await eh(!0);let t=()=>e.getCanvas().style.cursor="pointer",a=()=>e.getCanvas().style.cursor="";[p,m,g,x,f,v].forEach(r=>{e.on("mouseenter",r,t),e.on("mouseleave",r,a)}),e.on("click",x,e=>ef(e)),e.on("click",f,e=>ef(e)),e.on("click",v,e=>ev(e)),e.on("click",p,e=>ef(e)),e.on("click",m,e=>ef(e)),e.on("click",g,e=>ev(e)),requestAnimationFrame(()=>{try{e.resize()}catch(e){}})}),()=>{var r,a,n;try{null===(r=Q.current)||void 0===r||r.abort()}catch(e){}Q.current=null,W.current&&(window.clearTimeout(W.current),W.current=null);try{null===(a=X.current)||void 0===a||a.disconnect()}catch(e){}X.current=null;try{null===(n=ea.current)||void 0===n||n.remove()}catch(e){}ea.current=null,window.removeEventListener("resize",t),window.removeEventListener("orientationchange",t);try{e.remove()}catch(e){}q.current=null}},[ei,el,eo,eu]),(0,n.useEffect)(()=>{eg()},[t,r,i,M]),(0,n.useEffect)(()=>{let e=q.current;if(e&&P){if(en.current){en.current=!1;return}e.flyTo({center:P.coords,zoom:12.5,essential:!0})}},[P]),(0,n.useEffect)(()=>{eh()},[z,E,el]),(0,a.jsxs)("div",{className:"relative w-full h-full min-h-0",children:[(0,a.jsx)("div",{ref:J,className:"w-full h-full min-h-[55vh] sm:min-h-0"}),"fallback"===ee&&(0,a.jsx)("div",{className:"absolute top-4 left-4 z-10",children:(0,a.jsxs)("div",{className:"rounded-xl border border-white/10 bg-neutral-900/90 shadow-2xl backdrop-blur px-3 py-2",style:{maxWidth:340},children:[(0,a.jsx)("div",{className:"text-[12px] font-extrabold text-yellow-300",children:"Route fallback active"}),(0,a.jsx)("div",{className:"text-[11px] text-white/80 mt-0.5",children:"Using a straight-line polyline (Directions API failed). Check token/network or retry."})]})})]})}var E=r(5255);function z(e){return Array.from(new Set(e.filter(Boolean))).sort((e,t)=>e.localeCompare(t))}function P(e){return(e||"").trim().toUpperCase()}function I(e,t){return e.toLowerCase().includes(t.toLowerCase())}function B(e){return e.toLowerCase().replace(/[^a-z0-9]+/g,"-")}function O(e){return e.replace(/[^0-9]/g,"")}function D(e,t){return t.every(t=>e.includes(t))}function Z(e){let t=e/1609.344;return isFinite(t)?t<.1?"<0.1 mi":t<10?"".concat(t.toFixed(1)," mi"):"".concat(t.toFixed(0)," mi"):"—"}function H(e){let t=e/60;if(!isFinite(t))return"—";if(t<1)return"<1 min";if(t<60)return"".concat(Math.round(t)," min");let r=Math.floor(t/60),a=Math.round(t-60*r);return"".concat(r,"h ").concat(a,"m")}function U(e){return String(e||"").toLowerCase().replace(/[\u2013\u2014]/g,"-").replace(/[^a-z0-9]+/g,"").trim()}function J(e){var t,r,a,n,i,l;for(let n of[e.lngLat,e.lnglat,e.coords,e.coord,e.coordinates,e.center,e.location]){if(Array.isArray(n)&&n.length>=2){let e=Number(n[0]),t=Number(n[1]);if(isFinite(e)&&isFinite(t)&&180>=Math.abs(e)&&90>=Math.abs(t))return[e,t]}if(n&&"object"==typeof n){let e=Number(null!==(r=null!==(t=n.lng)&&void 0!==t?t:n.lon)&&void 0!==r?r:n.longitude),i=Number(null!==(a=n.lat)&&void 0!==a?a:n.latitude);if(isFinite(e)&&isFinite(i)&&180>=Math.abs(e)&&90>=Math.abs(i))return[e,i]}}let o=Number(null!==(i=null!==(n=e.lng)&&void 0!==n?n:e.lon)&&void 0!==i?i:e.longitude),s=Number(null!==(l=e.lat)&&void 0!==l?l:e.latitude);return isFinite(o)&&isFinite(s)&&180>=Math.abs(o)&&90>=Math.abs(s)?[o,s]:null}function q(e){return"".concat(e[1],",").concat(e[0])}function G(){let[e,t]=(0,n.useState)([]),[r,i]=(0,n.useState)([]),[l,o]=(0,n.useState)([]),[s,c]=(0,n.useState)([]),[d,u]=(0,n.useState)([]),[p,m]=(0,n.useState)(""),[g,h]=(0,n.useState)([]),[x,f]=(0,n.useState)([]),[v,b]=(0,n.useState)([]),[y,w]=(0,n.useState)([]),[j,N]=(0,n.useState)(""),[k,S]=(0,n.useState)(""),[C,L]=(0,n.useState)("Home"),[R,A]=(0,n.useState)(null),[T,F]=(0,n.useState)(null),[_,G]=(0,n.useState)([]),[K,Q]=(0,n.useState)([]),[W,Y]=(0,n.useState)(null),[X,V]=(0,n.useState)(""),[$,ee]=(0,n.useState)(""),[et,er]=(0,n.useState)(""),[ea,en]=(0,n.useState)(""),[ei,el]=(0,n.useState)(""),[eo,es]=(0,n.useState)(""),ec=(0,n.useRef)(null),[ed,eu]=(0,n.useState)([]),[ep,em]=(0,n.useState)(null),[eg,eh]=(0,n.useState)(null),ex=(0,n.useRef)(null),ef=(0,n.useRef)(""),[ev,eb]=(0,n.useState)({[B("Legend")]:!1,[B("Trip Builder")]:!0,[B("Find a Stop")]:!0,[B("Routes & Stops")]:!0,[B("Channel Summary - Trip")]:!0,[B("Filters")]:!0,[B("Retail Summary - Channel")]:!0,[B("Future Data Layers")]:!0}),ey=(0,n.useMemo)(()=>"pk.eyJ1IjoiZG9jamJhaWxleTE5NzEiLCJhIjoiY21ld3lzZTNqMGQwdzJxb2lwNHpjcjNveiJ9.T2O5szdwL-O5nDF9BJmFnw".trim(),[]),ew=(0,n.useMemo)(()=>"/certis_agroute_app".trim()||"/certis_agroute_app",[]),ej=g.length||x.length||v.length||y.length,eN=(e,t,r)=>{r(t.includes(e)?t.filter(t=>t!==e):[...t,e])},ek=e=>{Q(t=>t.some(t=>t.id===e.id)?t:[...t,e])},eS=e=>Q(t=>t.filter(t=>t.id!==e)),eC=(e,t)=>{Q(r=>{let a=[...r],n=e+t;if(n<0||n>=a.length)return r;let i=a[e];return a[e]=a[n],a[n]=i,a})},eL=e=>Y(e),eR=e=>{eb(t=>({...t,[e]:!t[e]}))};(0,n.useEffect)(()=>{try{let e=sessionStorage.getItem(E.OF);if(!e)return;let t=JSON.parse(e);if(Array.isArray(null==t?void 0:t.selectedStates)&&h(t.selectedStates),Array.isArray(null==t?void 0:t.selectedRetailers)&&f(t.selectedRetailers),Array.isArray(null==t?void 0:t.selectedCategories)&&b(t.selectedCategories),Array.isArray(null==t?void 0:t.selectedSuppliers)&&w(t.selectedSuppliers),"string"==typeof(null==t?void 0:t.homeZipDraft)&&N(t.homeZipDraft),"string"==typeof(null==t?void 0:t.homeZipApplied)&&S(t.homeZipApplied),"string"==typeof(null==t?void 0:t.homeLabel)&&L(t.homeLabel),Array.isArray(null==t?void 0:t.homeCoords)&&t.homeCoords.length>=2){let e=Number(t.homeCoords[0]),r=Number(t.homeCoords[1]);isFinite(e)&&isFinite(r)&&A([e,r])}Array.isArray(null==t?void 0:t.tripStops)&&Q(t.tripStops)}catch(e){}},[]),(0,n.useEffect)(()=>{try{sessionStorage.setItem(E.OF,JSON.stringify({selectedStates:g,selectedRetailers:x,selectedCategories:v,selectedSuppliers:y,homeZipDraft:j,homeZipApplied:k,homeLabel:C,homeCoords:R,tripStops:K}))}catch(e){}},[g,x,v,y,j,k,C,R,K]);let eA=(0,n.useMemo)(()=>{let t=e.map(P),r=X.trim();return z(r?t.filter(e=>I(e,r)):t)},[e,X]),eT=(0,n.useMemo)(()=>{let e=$.trim();return e?r.filter(t=>I(t,e)):r},[r,$]),eF=(0,n.useMemo)(()=>{let e=et.trim();return e?l.filter(t=>I(t,e)):l},[l,et]),e_=(0,n.useMemo)(()=>{let e=ea.trim();return e?s.filter(t=>I(t,e)):s},[s,ea]),eM=e=>{es(String(null!=e?e:ei).trim()),ec.current&&(ec.current.scrollTop=0)},eE=()=>{el(""),es(""),ec.current&&(ec.current.scrollTop=0)},ez=(0,n.useMemo)(()=>{let e=eo.trim();if(!e)return _.slice(0,30);let t=e.trim().toLowerCase().split(/\s+/g).map(e=>e.trim()).filter(Boolean);if(!t.length)return _.slice(0,30);let r=e.toLowerCase(),a=O(r),n=t.length>=2&&0===a.length,i=e=>[e.label,e.retailer,e.name,e.city,e.state,e.zip,e.address,e.email,e.phoneOffice,e.phoneCell,e.kind].filter(Boolean).map(e=>String(e)).join(" ").toLowerCase(),l=e=>[e.name,e.email,e.label].filter(Boolean).map(e=>String(e)).join(" ").toLowerCase(),o=(e,a)=>{let n=String(null!=e?e:"").toLowerCase().trim();if(!n)return 0;let i=0;if(n===r&&(i+=50*a),n.startsWith(r)&&(i+=28*a),n.includes(r)&&(i+=10*a),t.length>=2){let e=t.filter(e=>e&&n.includes(e)).length;e>0&&(i+=6*e*a),e===t.length&&(i+=22*a)}return i},s=(e,t)=>{if(a.length<3)return 0;let r=O(String(e||""));return r?r===a?40*t:r.startsWith(a)?26*t:r.includes(a)?14*t:0:0},c=_.map(e=>{if(!D(i(e),t)&&0===a.length||n&&!D(l(e),t))return null;let r=o(e.label,4),c=n?0:o(e.retailer||"",3),d=o(e.name||"",4),u=n?0:o(e.city||"",2),p=n?0:o(e.state||"",2),m=n?0:o(e.zip||"",3),g=n?0:o(e.address||"",1),h=o(e.email||"",4),x=r+c+d+u+p+m+g+h+s(e.phoneOffice||"",3)+s(e.phoneCell||"",3);if(n&&"kingpin"===e.kind&&(x+=18),x<=0)return null;let f=K.some(t=>t.id===e.id);return{st:e,score:x+(f?-2:0)}}).filter(Boolean);return c.sort((e,t)=>t.score-e.score),c.map(e=>e.st).slice(0,50)},[_,eo,K]),eP=(0,n.useMemo)(()=>{let e={};for(let t of _){if(!t||"kingpin"===t.kind)continue;let r=(t.retailer||"").trim()||"Unknown Retailer",a=U(r)||"unknownretailer";e[a]||(e[a]={displayRetailer:r,totalLocations:0,agronomyLocations:0,suppliers:new Set,states:new Set,categoryCounts:{}}),r.length>e[a].displayRetailer.length&&(e[a].displayRetailer=r),e[a].totalLocations+=1,t.state&&e[a].states.add(t.state),(function(e){let t=String(null!=e?e:"").trim();return t?t.split(/[;,|]/g).map(e=>e.trim()).filter(Boolean):[]})(t.suppliers).forEach(t=>e[a].suppliers.add(t));let n=function(e){let t=String(null!=e?e:"").trim();return t?t.split(",").map(e=>e.trim()).filter(Boolean):[]}(t.category);if(0===n.length){let t="Uncategorized";e[a].categoryCounts[t]=(e[a].categoryCounts[t]||0)+1}else for(let t of n){let r=function(e){let t=String(e||"").trim();return t||""}(t);r&&(e[a].categoryCounts[r]=(e[a].categoryCounts[r]||0)+1,function(e){let t=e.toLowerCase();return!(!t||t.includes("hq"))&&t.includes("agronomy")}(r)&&(e[a].agronomyLocations+=1))}}return e},[_]),eI=(0,n.useMemo)(()=>{let e={};for(let t of K){let r=(t.retailer||"").trim()||"Unknown Retailer",a=U(r)||"unknownretailer";e[a]||(e[a]={tripStops:0,displayRetailer:r}),e[a].tripStops+=1,r.length>e[a].displayRetailer.length&&(e[a].displayRetailer=r)}let t=Object.entries(e).map(e=>{var t,r;let[a,n]=e,i=eP[a],l=(null==i?void 0:i.displayRetailer)||n.displayRetailer||"Unknown Retailer",o=null!==(t=null==i?void 0:i.totalLocations)&&void 0!==t?t:0,s=null!==(r=null==i?void 0:i.agronomyLocations)&&void 0!==r?r:0,c=i?Array.from(i.suppliers).sort():[],d=i?Array.from(i.states).sort():[],u=i?function(e){let t=Object.entries(e).filter(e=>{let[,t]=e;return t>0}),r=["Agronomy","Grain","Distribution","Energy","Service","C-Store","Corporate HQ","Regional HQ","HQ","Kingpin"].map(e=>e.toLowerCase());return t.sort((e,t)=>{let a=e[0].toLowerCase(),n=t[0].toLowerCase(),i=r.indexOf(a),l=r.indexOf(n);return -1!==i&&-1!==l?i-l:-1!==i?-1:-1!==l?1:a.localeCompare(n)}),t.map(e=>{let[t,r]=e;return"".concat(t," (").concat(r,")")})}(i.categoryCounts):[];return{retailer:l,tripStops:n.tripStops,totalLocations:o,agronomyLocations:s,suppliers:c,categoryBreakdown:u,states:d}});return t.sort((e,t)=>t.tripStops!==e.tripStops?t.tripStops-e.tripStops:e.retailer.localeCompare(t.retailer)),t},[K,eP]),eB=(0,n.useMemo)(()=>{let e=p.trim().toLowerCase();return e?d.filter(t=>(t.retailer||"").toLowerCase().includes(e)).slice(0,120):d.slice(0,120)},[d,p]),eO=async()=>{let e=O(j||"").slice(0,5);if(!e||e.length<5){F({ok:!1,msg:"Enter a 5-digit ZIP."});return}if(!ey){F({ok:!1,msg:"Mapbox token missing (NEXT_PUBLIC_MAPBOX_TOKEN)."});return}F({ok:!0,msg:"Locating ZIP…"});try{var t;let r="https://api.mapbox.com/geocoding/v5/mapbox.places/"+encodeURIComponent(e)+".json?"+new URLSearchParams({access_token:ey,country:"us",limit:"1",types:"postcode"}).toString(),a=await fetch(r);if(!a.ok){F({ok:!1,msg:"ZIP lookup failed (".concat(a.status,").")});return}let n=await a.json(),i=null==n?void 0:null===(t=n.features)||void 0===t?void 0:t[0],l=null==i?void 0:i.center;if(!Array.isArray(l)||l.length<2){F({ok:!1,msg:"ZIP not found."});return}let o=Number(l[0]),s=Number(l[1]);if(!isFinite(o)||!isFinite(s)){F({ok:!1,msg:"Invalid ZIP coordinates."});return}S(e),A([o,s]),L("Home (".concat(e,")")),F({ok:!0,msg:"Home set to ".concat(e,".")})}catch(e){F({ok:!1,msg:"ZIP lookup error: ".concat(String((null==e?void 0:e.message)||e))})}},eD=()=>{N(""),S(""),A(null),L("Home"),F(null)},eZ=(0,n.useMemo)(()=>{let e=[];for(let t of(R&&e.push(R),K)){let r=J(t);r&&e.push(r)}return e},[R,K]),eH=(0,n.useMemo)(()=>eZ.map(q),[eZ]),eU=(0,n.useMemo)(()=>(function(e){if(e.length<2)return"";let t=e[0],r=e[e.length-1],a=e.slice(1,-1),n=new URLSearchParams;return n.set("api","1"),n.set("travelmode","driving"),n.set("origin",t),n.set("destination",r),a.length&&n.set("waypoints",a.join("|")),"https://www.google.com/maps/dir/?".concat(n.toString())})(eH),[eH]),eJ=(0,n.useMemo)(()=>(function(e){if(e.length<2)return"";let t=e[0],r=e.slice(1).join("+to:"),a=new URLSearchParams;return a.set("dirflg","d"),a.set("saddr",t),a.set("daddr",r),"https://maps.apple.com/?".concat(a.toString())})(eH),[eH]),eq=(0,n.useMemo)(()=>eH.length<2?"":function(e){let t=new URLSearchParams;return t.set("ll",e),t.set("navigate","yes"),"https://waze.com/ul?".concat(t.toString())}(eH[1]||eH[eH.length-1]),[eH]),eG=eZ.length>=2&&!!ey;(0,n.useEffect)(()=>{if(!eG){eu([]),em(null),ey?eh(null):eh({ok:!1,msg:"Token missing — cannot compute route legs."});return}let e=eZ.slice(0,25),t=JSON.stringify(e);if(t===ef.current)return;ef.current=t,ex.current&&ex.current.abort();let r=new AbortController;ex.current=r;let a=async()=>{try{var t;eh({ok:!0,msg:"Computing distances/times…"});let a=e.map(e=>"".concat(e[0],",").concat(e[1])).join(";"),n="https://api.mapbox.com/directions/v5/mapbox/driving/"+a+"?"+new URLSearchParams({access_token:ey,geometries:"geojson",overview:"false",steps:"false",alternatives:"false"}).toString(),i=await fetch(n,{signal:r.signal});if(!i.ok){eu([]),em(null),eh({ok:!1,msg:"Directions failed (".concat(i.status,").")});return}let l=await i.json(),o=null==l?void 0:null===(t=l.routes)||void 0===t?void 0:t[0],s=null==o?void 0:o.legs;if(!o||!Array.isArray(s)||0===s.length){eu([]),em(null),eh({ok:!1,msg:"No route legs returned."});return}let c=[];for(let e of(R&&c.push(C),K))J(e)&&c.push(e.label||"Stop");let d=[],u=0,p=0;for(let e=0;e<s.length;e++){let t=s[e],r=Number((null==t?void 0:t.distance)||0),a=Number((null==t?void 0:t.duration)||0);u+=isFinite(r)?r:0,p+=isFinite(a)?a:0,d.push({fromLabel:c[e]||(0===e?"Start":"Stop ".concat(e)),toLabel:c[e+1]||"Stop ".concat(e+1),distanceMeters:isFinite(r)?r:0,durationSeconds:isFinite(a)?a:0})}eu(d),em({distanceMeters:u,durationSeconds:p}),eh({ok:!0,msg:"Route legs updated."})}catch(e){if("aborterror"===String((null==e?void 0:e.name)||"").toLowerCase())return;eu([]),em(null),eh({ok:!1,msg:"Directions error: ".concat(String((null==e?void 0:e.message)||e))})}},n=window.setTimeout(a,220);return()=>window.clearTimeout(n)},[eG,eZ,ey,R,C,K]);let eK=(0,n.useMemo)(()=>({"--cad-sb-top":"rgba(10, 32, 84, 0.72)","--cad-sb-bot":"rgba(5, 10, 24, 0.72)","--cad-sb-border":"rgba(165, 243, 252, 0.22)","--cad-sb-ring":"rgba(56, 189, 248, 0.18)","--cad-sec-top":"rgba(18, 66, 170, 0.22)","--cad-sec-bot":"rgba(4, 10, 24, 0.20)","--cad-sec-border":"rgba(165, 243, 252, 0.18)","--cad-sec-ring":"rgba(59, 130, 246, 0.12)","--cad-tile-top":"rgba(59, 130, 246, 0.14)","--cad-tile-bot":"rgba(8, 20, 45, 0.12)","--cad-tile-border":"rgba(165, 243, 252, 0.16)","--cad-tile-ring":"rgba(147, 197, 253, 0.10)","--cad-list-top":"rgba(10, 30, 80, 0.16)","--cad-list-bot":"rgba(6, 12, 28, 0.14)"}),[]),eQ="rounded-2xl border ring-1 backdrop-blur-sm px-3 py-3 bg-[linear-gradient(180deg,var(--cad-sec-top),var(--cad-sec-bot))] border-[color:var(--cad-sec-border)] ring-[color:var(--cad-sec-ring)]",eW="rounded-xl border ring-1 backdrop-blur-sm p-3 bg-[linear-gradient(180deg,var(--cad-tile-top),var(--cad-tile-bot))] border-[color:var(--cad-tile-border)] ring-[color:var(--cad-tile-ring)] shadow-[0_14px_30px_rgba(0,0,0,0.45)]",eY="max-h-52 overflow-y-auto pr-1 space-y-1 rounded-xl border ring-1 backdrop-blur-sm p-2 bg-[linear-gradient(180deg,var(--cad-list-top),var(--cad-list-bot))] border-[color:var(--cad-tile-border)] ring-[color:var(--cad-tile-ring)]",eX="text-sm font-extrabold tracking-wide text-yellow-300",eV="text-sm font-extrabold leading-tight text-yellow-300",e$="text-xs text-[#d7c3a1]",e0="text-xs text-white/75",e1="text-xs px-2 py-1 rounded-lg border border-cyan-200/20 hover:border-cyan-200/40 hover:bg-white/10 disabled:opacity-40 disabled:cursor-not-allowed",e2="w-full rounded-xl bg-[#061126]/55 border border-cyan-200/20 ring-1 ring-blue-200/10 px-3 py-2 text-sm outline-none focus:border-cyan-200/45 focus:ring-cyan-200/20",e5=e=>{let{label:t}=e;return(0,a.jsxs)("div",{className:"my-3",children:[(0,a.jsx)("div",{className:"h-px bg-white/10"}),(0,a.jsx)("div",{className:"mt-2 text-[11px] font-extrabold tracking-wide text-white/60",children:t})]})},e4=e=>{let{up:t}=e;return(0,a.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24","aria-hidden":"true",className:"inline-block",style:{transform:t?"rotate(180deg)":"rotate(0deg)"},children:(0,a.jsx)("path",{d:"M6 9l6 6 6-6",fill:"none",stroke:"rgba(253,224,71,0.95)",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})},e6=e=>{let{title:t,right:r,k:n}=e,i=!!ev[n];return(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>eR(n),className:"flex items-center gap-2",title:i?"Expand":"Collapse",children:[(0,a.jsx)("span",{className:eX,children:t}),(0,a.jsx)("span",{className:"opacity-90",children:i?(0,a.jsx)(e4,{up:!1}):(0,a.jsx)(e4,{up:!0})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[r,(0,a.jsx)("button",{type:"button",onClick:()=>eR(n),className:"text-xs px-3 py-1.5 rounded-xl border border-cyan-200/20 bg-[#061126]/45 hover:bg-white/10 hover:border-cyan-200/40",children:i?"Expand":"Collapse"})]})]})},e3=ei.trim().split(/\s+/g).filter(Boolean).length>=2?'Strict person search: multi-word queries must match name/email (e.g., "James Klein").':'Search tip: multi-word queries act like a strict name search (e.g., "James Klein").',e8=(0,n.useMemo)(()=>{let e=e=>l.includes(e),t=e("Agronomy")?"Agronomy":l.find(e=>e.toLowerCase().includes("agronomy"))||"Agronomy",r=e("Grain/Feed")?"Grain/Feed":l.find(e=>e.toLowerCase().includes("grain"))||"Grain/Feed",a=e("C-Store/Service/Energy")?"C-Store/Service/Energy":l.find(e=>e.toLowerCase().includes("c-store")||e.toLowerCase().includes("service")||e.toLowerCase().includes("energy"))||"C-Store/Service/Energy";return[{label:t,swatch:"#22c55e",kind:"dot"},{label:r,swatch:"#f97316",kind:"dot"},{label:a,swatch:"#0ea5e9",kind:"dot"},{label:e("Distribution")?"Distribution":l.find(e=>e.toLowerCase().includes("distribution"))||"Distribution",swatch:"#a855f7",kind:"dot"},{label:e("Regional HQ")?"Regional HQ":l.find(e=>e.toLowerCase().includes("hq"))||"Regional HQ",swatch:"#ff0000",kind:"hq"},{label:"Kingpin",swatch:"#2563eb",kind:"kingpin"}]},[l]),e9=(0,n.useMemo)(()=>new Date().toISOString(),[]);return(0,a.jsxs)("div",{className:"min-h-screen w-full text-white flex flex-col ".concat("bg-[#050914] bg-[radial-gradient(1200px_720px_at_10%_0%,rgba(37,99,235,0.12),transparent_60%),radial-gradient(900px_600px_at_88%_18%,rgba(14,165,233,0.10),transparent_60%),radial-gradient(900px_600px_at_40%_120%,rgba(34,197,94,0.05),transparent_60%)]"),children:[(0,a.jsx)("header",{className:"w-full border-b border-slate-200/15 bg-slate-950/30 backdrop-blur-md flex-shrink-0",children:(0,a.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between gap-4",children:[(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsx)("img",{src:"".concat(ew,"/icons/certis-logo.png"),alt:"Certis Biologicals",className:"h-14 sm:h-16 w-auto drop-shadow-[0_10px_18px_rgba(0,0,0,0.65)]",draggable:!1})}),(0,a.jsx)("div",{className:"ml-auto text-yellow-400 font-extrabold tracking-wide text-lg sm:text-xl text-right",children:"CERTIS AgRoute Database"})]})}),(0,a.jsx)("div",{className:"flex-1 min-h-0 p-3",children:(0,a.jsxs)("div",{className:"h-full min-h-0 flex flex-col lg:grid lg:grid-cols-[380px_1fr] gap-3",children:[(0,a.jsx)("main",{className:"rounded-2xl border border-slate-200/15 ring-1 ring-white/10 bg-slate-950/20 backdrop-blur-md shadow-[0_22px_50px_rgba(0,0,0,0.55)] overflow-hidden map-container w-full h-[60vh] min-h-[420px] sm:h-[65vh] md:h-[70vh] lg:h-full lg:min-h-0 order-1 lg:order-2",children:(0,a.jsx)(M,{selectedStates:g.map(P),selectedRetailers:x,selectedCategories:v,selectedSuppliers:y,homeCoords:R,tripStops:K,zoomToStop:W,onStatesLoaded:e=>t(z(e.map(P))),onRetailersLoaded:e=>i(z(e)),onCategoriesLoaded:e=>o(z(e)),onSuppliersLoaded:e=>c(z(e)),onAllStopsLoaded:e=>G(e),onAddStop:ek,onRetailerNetworkSummaryLoaded:e=>u(e)})}),(0,a.jsx)("aside",{style:eK,className:"".concat("rounded-2xl border ring-1 backdrop-blur-md bg-[linear-gradient(180deg,var(--cad-sb-top),var(--cad-sb-bot))] border-[color:var(--cad-sb-border)] ring-[color:var(--cad-sb-ring)] shadow-[0_26px_60px_rgba(0,0,0,0.65)]"," sidebar min-h-0 lg:h-full ").concat("order-2 lg:order-1"),children:(0,a.jsxs)("div",{className:"overflow-y-auto px-4 py-3 space-y-4",children:[(0,a.jsxs)("div",{className:eQ,children:[(0,a.jsx)(e6,{title:"Legend",k:B("Legend")}),!ev[B("Legend")]&&(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsxs)("div",{className:"rounded-xl border ring-1 backdrop-blur-sm px-3 py-3 bg-[linear-gradient(180deg,var(--cad-list-top),var(--cad-list-bot))] border-[color:var(--cad-tile-border)] ring-[color:var(--cad-tile-ring)]",children:[(0,a.jsx)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2",children:e8.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:["dot"===e.kind&&(0,a.jsx)("span",{className:"inline-block h-3 w-3 rounded-full border border-black/40 flex-shrink-0",style:{background:e.swatch},"aria-hidden":"true"}),"hq"===e.kind&&(0,a.jsx)("span",{className:"inline-block h-3 w-3 rounded-full border border-black/40 flex-shrink-0",style:{background:e.swatch,boxShadow:"0 0 0 2px rgba(250,204,21,0.85) inset"},"aria-hidden":"true"}),"kingpin"===e.kind&&(0,a.jsx)("span",{className:"inline-flex items-center justify-center h-4 w-4 flex-shrink-0","aria-hidden":"true",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 128 128",width:"16",height:"16",children:(0,a.jsx)("path",{d:"M64 14 L78.6 47.5 L115 52.2 L88 75.1 L96.1 110 L64 92 L31.9 110 L40 75.1 L13 52.2 L49.4 47.5 Z",fill:e.swatch,stroke:"#0b1220",strokeWidth:"6",strokeLinejoin:"round"})})}),(0,a.jsx)("div",{className:"flex-1 text-sm font-normal text-white/90 leading-tight truncate",children:e.label})]},e.label))}),(0,a.jsx)("div",{className:"mt-2 text-[11px] text-white/60",children:"Kingpins are always visible (offset slightly to avoid overlap)."})]})})]}),(0,a.jsxs)("div",{className:eQ,children:[(0,a.jsx)(e6,{title:"Trip Builder",k:B("Trip Builder"),right:(0,a.jsx)("button",{onClick:()=>{Q([]),Y(null),eu([]),em(null),eh(null)},className:e1,disabled:0===K.length&&!R,children:"Clear Trip"})}),!ev[B("Trip Builder")]&&(0,a.jsxs)("div",{className:"space-y-3 mt-3",children:[(0,a.jsxs)("div",{className:eW,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("div",{className:eV,children:"Home ZIP"}),(0,a.jsx)("button",{onClick:eD,className:e1,disabled:!R&&!j&&!k,children:"Clear"})]}),(0,a.jsxs)("div",{className:"mt-2 grid grid-cols-[1fr_auto] gap-2",children:[(0,a.jsx)("input",{value:j,onChange:e=>N(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),eO()),"Escape"===e.key&&(e.preventDefault(),eD())},placeholder:"Enter ZIP (e.g., 50266)",className:e2,inputMode:"numeric"}),(0,a.jsx)("button",{type:"button",onClick:eO,className:"text-xs px-3 py-2 rounded-xl bg-[#fde047] text-black font-extrabold hover:bg-[#fde047]/90",children:"Set"})]}),(0,a.jsx)("div",{className:"mt-2 text-[11px] text-white/70",children:R?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-white/90 font-semibold",children:"Applied:"})," ",k||"—"," ",(0,a.jsx)("span",{className:"text-white/60",children:"•"})," ",(0,a.jsxs)("span",{className:"text-white/80",children:[R[1].toFixed(4),", ",R[0].toFixed(4)]})]}):(0,a.jsx)(a.Fragment,{children:"Tip: Set Home ZIP to get full route links + leg distances/times."})}),T&&(0,a.jsx)("div",{className:"mt-2 text-[11px] ".concat(T.ok?"text-green-300":"text-red-300"),children:T.msg})]}),(0,a.jsx)(e5,{label:"TRIP PLANNING"}),(0,a.jsxs)("div",{className:eQ,children:[(0,a.jsx)(e6,{title:"Find a Stop",k:B("Find a Stop"),right:(0,a.jsxs)("div",{className:"text-[11px] text-white/65 whitespace-nowrap",children:["Loaded: ",_.length]})}),!ev[B("Find a Stop")]&&(0,a.jsxs)("div",{className:"space-y-2 mt-3",children:[(0,a.jsx)("input",{value:ei,onChange:e=>el(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),eM()),"Escape"===e.key&&(e.preventDefault(),eE())},placeholder:'Type search, then press Enter (e.g., "James Klein" or "Hull Coop")',className:e2,"aria-label":"Find a Stop search"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>eM(),className:"text-xs px-3 py-2 rounded-xl bg-[#fde047] text-black font-extrabold hover:bg-[#fde047]/90",title:"Apply search (Enter)",children:"Search"}),(0,a.jsx)("button",{type:"button",onClick:eE,className:e1,disabled:!ei&&!eo,children:"Clear"}),(0,a.jsxs)("div",{className:"ml-auto text-[11px] text-white/60",children:["Applied:"," ",(0,a.jsx)("span",{className:"text-white/85 font-semibold",children:eo?'"'.concat(eo,'"'):"—"})]})]}),(0,a.jsx)("div",{className:e$,children:e3}),(0,a.jsxs)("div",{ref:ec,className:"max-h-64 overflow-y-auto space-y-2 rounded-xl border ring-1 backdrop-blur-sm p-2 bg-[linear-gradient(180deg,var(--cad-list-top),var(--cad-list-bot))] border-[color:var(--cad-tile-border)] ring-[color:var(--cad-tile-ring)]",children:[ez.map(e=>{let t=K.some(t=>t.id===e.id);return(0,a.jsx)("div",{className:eW,children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:eV,children:e.label}),(0,a.jsxs)("div",{className:e$,children:[(e.city||"")+(e.city?", ":""),e.state||"",e.zip?" ".concat(e.zip):"",e.kind?" • ".concat(e.kind):""]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>eL(e),className:e1,children:"Zoom"}),(0,a.jsx)("button",{onClick:()=>ek(e),className:"text-xs px-2 py-1 rounded-lg bg-[#fde047] text-black font-extrabold hover:bg-[#fde047]/90 disabled:opacity-50",disabled:t,children:t?"Added":"Add"})]})]})},e.id)}),0===ez.length&&(0,a.jsx)("div",{className:e0,children:"No matches."})]},eo||"__empty__")]})]}),(0,a.jsx)(e5,{label:"ROUTE & STOPS"}),(0,a.jsxs)("div",{className:eQ,children:[(0,a.jsx)(e6,{title:"Routes & Stops",k:B("Routes & Stops")}),!ev[B("Routes & Stops")]&&(0,a.jsxs)("div",{className:"space-y-3 mt-3",children:[K.map((e,t)=>(0,a.jsx)("div",{className:eW,children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"".concat(eV," !text-sm"),children:[t+1,". ",e.label]}),(0,a.jsxs)("div",{className:e$,children:[(e.city||"")+(e.city?", ":""),e.state||"",e.zip?" ".concat(e.zip):"",e.kind?" • ".concat(e.kind):""]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,a.jsx)("button",{onClick:()=>eL(e),className:e1,children:"Zoom"}),(0,a.jsx)("button",{onClick:()=>eS(e.id),className:e1,children:"Remove"})]}),(0,a.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,a.jsx)("button",{onClick:()=>eC(t,-1),className:e1,disabled:0===t,title:"Move up",children:"↑"}),(0,a.jsx)("button",{onClick:()=>eC(t,1),className:e1,disabled:t===K.length-1,title:"Move down",children:"↓"})]})]})]})},e.id)),0===K.length&&(0,a.jsx)("div",{className:e$,children:"Add stops from map popups (“Add to Trip”) or from “Find a Stop”."}),K.length>0&&(0,a.jsx)("div",{className:"h-px bg-white/10 my-1"}),(0,a.jsxs)("div",{className:eW,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("div",{className:eV,children:"Distances & Times"}),ep?(0,a.jsxs)("div",{className:"text-xs text-white/75 whitespace-nowrap",children:["Total: ",Z(ep.distanceMeters)," • ",H(ep.durationSeconds)]}):(0,a.jsx)("div",{className:"text-[11px] text-white/60 whitespace-nowrap",children:"—"})]}),(0,a.jsxs)("div",{className:"mt-2 space-y-2",children:[!ey&&(0,a.jsx)("div",{className:"text-[11px] text-red-300",children:"Token missing — cannot compute route legs."}),eg&&(0,a.jsx)("div",{className:"text-[11px] ".concat(eg.ok?"text-green-300":"text-red-300"),children:eg.msg}),ed.length>0?(0,a.jsx)("div",{className:"space-y-2",children:ed.map((e,t)=>(0,a.jsxs)("div",{className:"rounded-xl border border-cyan-200/15 bg-[#061126]/35 p-2",children:[(0,a.jsxs)("div",{className:"text-xs text-white/85 font-semibold leading-tight",children:[e.fromLabel," → ",e.toLabel]}),(0,a.jsxs)("div",{className:"text-[11px] text-white/70 mt-1",children:[Z(e.distanceMeters)," • ",H(e.durationSeconds)]})]},"".concat(e.fromLabel,"-").concat(e.toLabel,"-").concat(t)))}):(0,a.jsx)("div",{className:"text-[11px] text-white/60",children:"Set Home ZIP and add ≥ 1 stop to compute legs (or add ≥ 2 stops without Home)."})]})]}),(0,a.jsxs)("div",{className:eW,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("div",{className:eV,children:"Send to Phone"}),(0,a.jsx)("div",{className:"text-[11px] text-white/60",children:eZ.length>=2?"".concat(eZ.length," points"):"Add ≥ 1 stop"})]}),(0,a.jsxs)("div",{className:"mt-2 grid grid-cols-3 gap-2",children:[(0,a.jsx)("a",{href:eU||"#",target:"_blank",rel:"noreferrer",className:"text-center text-xs px-2 py-2 rounded-xl border border-cyan-200/20 ".concat(eU?"hover:border-cyan-200/40 hover:bg-white/10":"opacity-40 pointer-events-none"),children:"Google"}),(0,a.jsx)("a",{href:eJ||"#",target:"_blank",rel:"noreferrer",className:"text-center text-xs px-2 py-2 rounded-xl border border-cyan-200/20 ".concat(eJ?"hover:border-cyan-200/40 hover:bg-white/10":"opacity-40 pointer-events-none"),children:"Apple"}),(0,a.jsx)("a",{href:eq||"#",target:"_blank",rel:"noreferrer",className:"text-center text-xs px-2 py-2 rounded-xl border border-cyan-200/20 ".concat(eq?"hover:border-cyan-200/40 hover:bg-white/10":"opacity-40 pointer-events-none"),title:"Waze opens the next stop (single-destination)",children:"Waze"})]}),(0,a.jsxs)("div",{className:"mt-2 text-[11px] text-white/60",children:["Waze opens the ",(0,a.jsx)("span",{className:"text-white/85 font-semibold",children:"next stop"})," (single-destination)."]})]}),(0,a.jsx)(E.Ay,{basePath:ew,homeLabel:C,homeZip:k,homeCoords:R,tripStops:K,routeLegs:ed,routeTotals:ep,channelSummaryRows:eI,generatedAt:e9})]})]}),(0,a.jsxs)("div",{className:eQ,children:[(0,a.jsx)(e6,{title:"Channel Summary - Trip",k:B("Channel Summary - Trip")}),!ev[B("Channel Summary - Trip")]&&(0,a.jsxs)("div",{className:"space-y-2 mt-3",children:[eI.slice(0,80).map(e=>(0,a.jsxs)("div",{className:eW,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("div",{className:eV,children:e.retailer}),(0,a.jsxs)("div",{className:"text-xs text-white/75 whitespace-nowrap",children:["Trip: ",e.tripStops," • Total: ",e.totalLocations]})]}),(0,a.jsxs)("div",{className:"text-xs text-white/80 mt-2 space-y-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-extrabold text-white/90",children:"Agronomy locations:"})," ",e.agronomyLocations]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-extrabold text-white/90",children:"States:"})," ",e.states.join(", ")||"—"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-extrabold text-white/90",children:"Category breakdown:"})," ",e.categoryBreakdown.join(", ")||"—"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-extrabold text-white/90",children:"Suppliers:"})," ",e.suppliers.join(", ")||"—"]})]})]},e.retailer)),0===eI.length&&(0,a.jsx)("div",{className:e0,children:"No trip stops yet."})]})]})]})]}),(0,a.jsx)("div",{className:"text-[11px] font-extrabold tracking-wide text-white/60 px-1",children:"CHANNEL EXPLORER"}),(0,a.jsxs)("div",{className:eQ,children:[(0,a.jsx)(e6,{title:"Filters",k:B("Filters"),right:(0,a.jsx)("button",{onClick:()=>{h([]),f([]),b([]),w([])},className:e1,disabled:!ej,children:"Clear All"})}),!ev[B("Filters")]&&(0,a.jsxs)("div",{className:"space-y-4 mt-3",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:eX,children:"State"}),(0,a.jsx)("button",{onClick:()=>h([]),className:e1,disabled:0===g.length,children:"Clear"})]}),(0,a.jsx)("input",{value:X,onChange:e=>V(e.target.value),placeholder:"Search states…",className:e2}),(0,a.jsxs)("div",{className:eY,children:[eA.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:g.includes(e),onChange:()=>eN(e,g,h)}),(0,a.jsx)("span",{children:e})]},e)),0===eA.length&&(0,a.jsx)("div",{className:e0,children:"Loading…"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:eX,children:"Retailer"}),(0,a.jsx)("button",{onClick:()=>f([]),className:e1,disabled:0===x.length,children:"Clear"})]}),(0,a.jsx)("input",{value:$,onChange:e=>ee(e.target.value),placeholder:"Search retailers…",className:e2}),(0,a.jsxs)("div",{className:eY,children:[eT.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:x.includes(e),onChange:()=>eN(e,x,f)}),(0,a.jsx)("span",{children:e})]},e)),0===eT.length&&(0,a.jsx)("div",{className:e0,children:"Loading…"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:eX,children:"Category"}),(0,a.jsx)("button",{onClick:()=>b([]),className:e1,disabled:0===v.length,children:"Clear"})]}),(0,a.jsx)("input",{value:et,onChange:e=>er(e.target.value),placeholder:"Search categories…",className:e2}),(0,a.jsxs)("div",{className:eY,children:[eF.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:v.includes(e),onChange:()=>eN(e,v,b)}),(0,a.jsx)("span",{children:e})]},e)),0===eF.length&&(0,a.jsx)("div",{className:e0,children:"Loading…"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:eX,children:"Supplier"}),(0,a.jsx)("button",{onClick:()=>w([]),className:e1,disabled:0===y.length,children:"Clear"})]}),(0,a.jsx)("input",{value:ea,onChange:e=>en(e.target.value),placeholder:"Search suppliers…",className:e2}),(0,a.jsxs)("div",{className:eY,children:[e_.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:y.includes(e),onChange:()=>eN(e,y,w)}),(0,a.jsx)("span",{children:e})]},e)),0===e_.length&&(0,a.jsx)("div",{className:e0,children:"Loading…"})]})]})]})]}),(0,a.jsxs)("div",{className:eQ,children:[(0,a.jsx)(e6,{title:"Retail Summary - Channel",k:B("Retail Summary - Channel")}),!ev[B("Retail Summary - Channel")]&&(0,a.jsxs)("div",{className:"space-y-2 mt-3",children:[(0,a.jsx)("input",{value:p,onChange:e=>m(e.target.value),placeholder:"Search retailer name (channel)…",className:e2}),(0,a.jsxs)("div",{className:e$,children:["Computed from ",(0,a.jsx)("span",{className:"text-white/90 font-semibold",children:"retailers.geojson"})," (true location footprint)."]}),(0,a.jsxs)("div",{className:"space-y-2",children:[eB.map(e=>{var t;return(0,a.jsxs)("div",{className:eW,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("div",{className:eV,children:e.retailer}),(0,a.jsxs)("div",{className:"text-xs text-white/75 whitespace-nowrap",children:["Total: ",e.totalLocations," • Agronomy: ",e.agronomyLocations]})]}),(0,a.jsxs)("div",{className:"text-xs text-white/80 mt-2 space-y-1",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-extrabold text-white/90",children:"States:"})," ",e.states.join(", ")||"—"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-extrabold text-white/90",children:"Category breakdown:"})," ",(null===(t=e.categoryCounts)||void 0===t?void 0:t.length)?e.categoryCounts.map(e=>"".concat(e.category," (").concat(e.count,")")).join(", "):"—"]})]})]},e.retailer)}),0===d.length&&(0,a.jsx)("div",{className:e0,children:"Channel summary not loaded yet."}),d.length>0&&0===eB.length&&(0,a.jsx)("div",{className:e0,children:"No retailer matches that search."})]})]})]}),(0,a.jsxs)("div",{className:eQ,children:[(0,a.jsx)(e6,{title:"Future Data Layers",k:B("Future Data Layers")}),!ev[B("Future Data Layers")]&&(0,a.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,a.jsx)("div",{className:e$,children:"Placeholder framework for upcoming layers (e.g., Gross Revenue Generators). This section will eventually control:"}),(0,a.jsxs)("div",{className:"text-[11px] text-white/70 space-y-1",children:[(0,a.jsx)("div",{children:"• Layer on/off toggles"}),(0,a.jsx)("div",{children:"• Legend entries + symbology"}),(0,a.jsx)("div",{children:"• Search + filters specific to new datasets"}),(0,a.jsx)("div",{children:"• Exportable lists / summaries"})]})]})]}),(0,a.jsxs)("div",{className:"text-[11px] text-white/65",children:["Loaded: ",_.length," stops • Trip: ",K.length," • Home:"," ",(0,a.jsx)("span",{className:R?"text-green-300 font-semibold":"text-white/60",children:R?k||"SET":"—"})," ","• Token:"," ",(0,a.jsx)("span",{className:ey?"text-green-400 font-semibold":"text-red-400 font-semibold",children:ey?"OK":"MISSING"})]})]})})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[240,441,684,358],()=>t(4096)),_N_E=e.O()}]);