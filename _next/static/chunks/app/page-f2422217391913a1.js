(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2791:(e,t,r)=>{Promise.resolve().then(r.bind(r,2212))},2212:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var l=r(7437),a=r(2265),s=r(7719),i=r.n(s),n=r(357);i().accessToken="pk.eyJ1IjoiZG9jamJhaWxleTE5NzEiLCJhIjoiY21ld3lzZTNqMGQwdzJxb2lwNHpjcjNveiJ9.T2O5szdwL-O5nDF9BJmFnw";let o={Agronomy:{color:"#FFD700",outline:"#000"},"Grain/Feed":{color:"#228B22",outline:"#000"},"Office/Service":{color:"#1E90FF",outline:"#000"},Kingpin:{color:"#FF0000",outline:"#FFFF00"}};function c(e){let{selectedCategories:t,selectedStates:r,selectedSuppliers:s,selectedRetailers:c,onStatesLoaded:d,onRetailersLoaded:g,onRetailerSummary:u}=e,p=(0,a.useRef)(null),x=(0,a.useRef)(null),m=n.env.NEXT_PUBLIC_GEOJSON_URL||"".concat("/certis_agroute_app","/retailers.geojson");return(0,a.useEffect)(()=>{if(x.current)return;let e=new(i()).Map({container:p.current,style:"mapbox://styles/mapbox/satellite-streets-v12",center:[-98.5795,39.8283],zoom:4,projection:"mercator"});x.current=e,e.on("load",async()=>{try{let a=await fetch(m),s=await a.json(),n=new Set,c=new Set;for(let e of s.features){var t,r;let l=null===(t=e.properties)||void 0===t?void 0:t.State,a=null===(r=e.properties)||void 0===r?void 0:r.Retailer;l&&n.add(l),a&&c.add(a)}null==d||d(Array.from(n).sort()),null==g||g(Array.from(c).sort()),e.addSource("retailers",{type:"geojson",data:s}),e.addLayer({id:"retailers-layer",type:"circle",source:"retailers",paint:{"circle-radius":6,"circle-color":["match",["get","Category"],"Agronomy",o.Agronomy.color,"Grain/Feed",o["Grain/Feed"].color,"Office/Service",o["Office/Service"].color,"#1d4ed8"],"circle-stroke-width":1,"circle-stroke-color":"#fff"},filter:["!=",["get","Category"],"Kingpin"]}),e.addLayer({id:"kingpins-layer",type:"circle",source:"retailers",paint:{"circle-radius":8,"circle-color":o.Kingpin.color,"circle-stroke-width":2,"circle-stroke-color":o.Kingpin.outline},filter:["==",["get","Category"],"Kingpin"]});let u=new(i()).Popup({closeButton:!1,closeOnClick:!1});function l(e){return'\n            <div style="font-size: 13px; background:#1a1a1a; color:#f5f5f5; padding:6px; border-radius:4px;">\n              <strong>'.concat(e.Retailer||"Unknown","</strong><br/>\n              <em>").concat(e.Name||"","</em><br/>\n              ").concat(e.Address||""," ").concat(e.City||""," ").concat(e.State||""," ").concat(e.Zip||"","<br/>\n              Supplier: ").concat(e.Suppliers||"N/A","\n            </div>\n          ")}e.on("mouseenter","retailers-layer",t=>{var r,a;e.getCanvas().style.cursor="pointer";let s=null===(r=t.features)||void 0===r?void 0:r[0].geometry,i=null==s?void 0:s.coordinates.slice(),n=null===(a=t.features)||void 0===a?void 0:a[0].properties;i&&n&&u.setLngLat(i).setHTML(l(n)).addTo(e)}),e.on("mouseleave","retailers-layer",()=>{e.getCanvas().style.cursor="",u.remove()}),e.on("mouseenter","kingpins-layer",t=>{var r,a;e.getCanvas().style.cursor="pointer";let s=null===(r=t.features)||void 0===r?void 0:r[0].geometry,i=null==s?void 0:s.coordinates.slice(),n=null===(a=t.features)||void 0===a?void 0:a[0].properties;i&&n&&u.setLngLat(i).setHTML(l(n)).addTo(e)}),e.on("mouseleave","kingpins-layer",()=>{e.getCanvas().style.cursor="",u.remove()}),e.on("click","retailers-layer",t=>{var r,a;let s=null===(r=t.features)||void 0===r?void 0:r[0].geometry,n=null==s?void 0:s.coordinates.slice(),o=null===(a=t.features)||void 0===a?void 0:a[0].properties;n&&o&&new(i()).Popup().setLngLat(n).setHTML(l(o)).addTo(e)}),e.on("click","kingpins-layer",t=>{var r,a;let s=null===(r=t.features)||void 0===r?void 0:r[0].geometry,n=null==s?void 0:s.coordinates.slice(),o=null===(a=t.features)||void 0===a?void 0:a[0].properties;n&&o&&new(i()).Popup().setLngLat(n).setHTML(l(o)).addTo(e)})}catch(e){console.error("Failed to load GeoJSON",e)}})},[m,d,g]),(0,a.useEffect)(()=>{if(!x.current)return;let e=x.current.getSource("retailers");e&&fetch(m).then(e=>e.json()).then(l=>{let a=e=>(e||"").toString().trim().toLowerCase(),i={type:"FeatureCollection",features:l.features.filter(e=>{let l=e.properties||{};if("Kingpin"===l.Category)return!0;let i=0===r.length||r.map(a).includes(a(l.State)),n=0===c.length||c.map(a).includes(a(l.Retailer)),o=0===t.length||t.map(a).includes(a(l.Category)),d=0===s.length||s.map(a).includes(a(l.Suppliers));return i&&n&&o&&d})};if(e.setData(i),u){let e=new Map;for(let t of i.features){var n,o;let r=(null===(n=t.properties)||void 0===n?void 0:n.State)||"Unknown",l=(null===(o=t.properties)||void 0===o?void 0:o.Retailer)||"Unknown",a="".concat(r,"-").concat(l);e.has(a)||e.set(a,{state:r,retailer:l,count:0}),e.get(a).count+=1}u(Array.from(e.values()))}})},[m,r,c,t,s,u]),(0,l.jsx)("div",{ref:p,className:"w-full h-full"})}var d=r(6648),g=r(4697),u=r(2873);let p=e=>(e||"").toString().trim().toLowerCase();function x(){let[e,t]=(0,a.useState)([]),[r,s]=(0,a.useState)([]),[i,n]=(0,a.useState)([]),[x,m]=(0,a.useState)([]),[h,y]=(0,a.useState)([]),[b,f]=(0,a.useState)([]),[v,j]=(0,a.useState)([]),[k,N]=(0,a.useState)(!1),w=e=>{let t=p(e);n(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},S=e=>{let t=p(e);m(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},C=e=>{let t=p(e);f(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},L=v.filter(e=>"kingpin"===p(e.retailer)||"kingpin"===p(e.category||"")),F=v.filter(e=>"kingpin"!==p(e.retailer)&&"kingpin"!==p(e.category||""));return(0,l.jsxs)("div",{className:"flex h-screen w-screen relative",children:[(0,l.jsx)("button",{className:"absolute top-3 left-3 z-20 p-2 bg-gray-800 text-white rounded-md md:hidden",onClick:()=>N(!k),"aria-label":"Toggle sidebar",children:k?(0,l.jsx)(g.Z,{size:20}):(0,l.jsx)(u.Z,{size:20})}),(0,l.jsxs)("aside",{className:"fixed md:static top-0 left-0 h-full w-72 bg-gray-100 dark:bg-gray-900 p-4 border-r border-gray-300 dark:border-gray-700 overflow-y-auto z-10 transform transition-transform duration-300\n        ".concat(k?"translate-x-0":"-translate-x-full"," md:translate-x-0"),children:[(0,l.jsx)("div",{className:"flex items-center justify-center mb-6",children:(0,l.jsx)(d.default,{src:"".concat("/certis_agroute_app","/certis-logo.png"),alt:"Certis Logo",width:180,height:60,priority:!0})}),(0,l.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,l.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Home Zip Code"}),(0,l.jsx)("input",{type:"text",placeholder:"Enter ZIP",className:"w-full p-2 rounded border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100"})]}),(0,l.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,l.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"State Filter"}),(0,l.jsxs)("div",{className:"flex space-x-2 mb-3",children:[(0,l.jsx)("button",{onClick:()=>{m(e.map(p))},className:"px-2 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"Select All"}),(0,l.jsx)("button",{onClick:()=>{m([])},className:"px-2 py-1 bg-gray-600 text-white rounded text-sm hover:bg-gray-700",children:"Clear All"})]}),(0,l.jsx)("div",{className:"grid grid-cols-3 gap-2",children:e.map(e=>(0,l.jsxs)("label",{className:"flex items-center space-x-1",children:[(0,l.jsx)("input",{type:"checkbox",checked:x.includes(p(e)),onChange:()=>S(e),className:"mr-1"}),(0,l.jsx)("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:e})]},e))})]}),(0,l.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,l.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Retailer Filter"}),(0,l.jsx)("div",{className:"flex space-x-2 mb-3",children:(0,l.jsx)("button",{onClick:()=>{f([])},className:"px-2 py-1 bg-gray-600 text-white rounded text-sm hover:bg-gray-700",children:"Clear All"})}),(0,l.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:r.map(e=>(0,l.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:b.includes(p(e)),onChange:()=>C(e)}),(0,l.jsx)("span",{className:"text-gray-700 dark:text-gray-300 text-sm",children:e})]},e))})]}),(0,l.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,l.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Categories"}),(0,l.jsxs)("div",{className:"flex space-x-2 mb-4",children:[(0,l.jsx)("button",{onClick:()=>{n(Object.keys(o).filter(e=>"Kingpin"!==e).map(p))},className:"px-2 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"Select All"}),(0,l.jsx)("button",{onClick:()=>{n([])},className:"px-2 py-1 bg-gray-600 text-white rounded text-sm hover:bg-gray-700",children:"Clear All"})]}),(0,l.jsx)("ul",{className:"space-y-2",children:Object.entries(o).map(e=>{let[t,r]=e;return(0,l.jsxs)("li",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",id:"filter-".concat(t),checked:i.includes(p(t)),onChange:()=>w(t),className:"mr-2",disabled:"Kingpin"===t}),(0,l.jsxs)("label",{htmlFor:"filter-".concat(t),className:"flex items-center text-gray-700 dark:text-gray-300",children:[(0,l.jsx)("span",{className:"inline-block w-4 h-4 mr-2 rounded-full border",style:{backgroundColor:r.color,borderColor:r.outline||"#000"}}),t]})]},t)})}),(0,l.jsx)("p",{className:"mt-3 text-sm text-red-600 dark:text-yellow-400 font-semibold",children:"Kingpins are always visible (bright red, yellow border)."})]}),(0,l.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",children:[(0,l.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Channel Summary"}),(0,l.jsxs)("div",{className:"text-sm text-gray-700 dark:text-gray-300 space-y-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:["Selected States (",x.length,"):"]})," ",x.length>0?x.join(", "):"None"]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("strong",{children:["Selected Retailers (",b.length,"):"]})," ",b.length>0?b.join(", "):"None"]}),L.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"Kingpins:"}),(0,l.jsx)("ul",{className:"list-disc ml-5",children:L.map((e,t)=>(0,l.jsxs)("li",{children:[e.state,", ",e.retailer," – ",e.count," locations",e.suppliers?" (Suppliers: ".concat(e.suppliers,")"):""]},t))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"Retailer Summary:"})," ",F.length>0?(0,l.jsx)("ul",{className:"list-disc ml-5",children:F.map((e,t)=>(0,l.jsxs)("li",{children:[e.state,", ",e.retailer," – ",e.count," locations",e.suppliers?" (Suppliers: ".concat(e.suppliers,")"):""]},t))}):"None"]})]})]}),(0,l.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow",children:[(0,l.jsx)("h2",{className:"text-lg font-bold mb-3 text-gray-800 dark:text-gray-200",children:"Trip Optimization"}),(0,l.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Collect points and optimize route"})]})]}),(0,l.jsx)("main",{className:"flex-1 relative",children:(0,l.jsx)(c,{selectedCategories:i,selectedStates:x,selectedSuppliers:h,selectedRetailers:b,onStatesLoaded:t,onRetailersLoaded:s,onRetailerSummary:j})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[415,758,130,215,744],()=>t(2791)),_N_E=e.O()}]);